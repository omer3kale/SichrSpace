<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Landlord Dashboard - SichrPlace</title>
  
  <!-- Favicon and Icons -->
  <link rel="icon" href="img/favicon.ico" sizes="any">
  <link rel="icon" href="img/favicon.svg" type="image/svg+xml">
  <style>
    :root {
      --primary: #2563eb;
      --secondary: #f9fafb;
      --accent: #40e0d0;
      --text: #222222;
      --muted: #6b7280;
      --card: #ffffff;
      --radius: 18px;
      --shadow: 0 2px 12px rgba(0,0,0,0.06);
      --heading-font: "Poppins", sans-serif;
      --body-font: "Roboto", sans-serif;
      --background: #f3f4f6;
      --foreground: #1f2937;
      --border: #e5e7eb;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--body-font);
      background: var(--secondary);
      color: var(--foreground);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .dashboard-root {
      max-width: 1200px;
      margin: 32px auto;
      padding: 0 24px 48px;
      display: flex;
      gap: 24px;
    }

    .sidebar {
      width: 260px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 0 20px 20px;
    }

    .sidebar-nav a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-radius: 12px;
      color: var(--foreground);
      font-family: var(--body-font);
      font-weight: 500;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .sidebar-nav a:hover,
    .sidebar-nav a.active {
      background: #e0e7ff;
      color: var(--primary);
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 24px;
      background: var(--secondary);
      padding: 24px;
      border-radius: var(--radius);
    }

    .dashboard-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
    }

    .dashboard-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      flex: 1 1 260px;
      min-width: 240px;
    }

    .form-container {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      margin-bottom: 32px;
    }

    .messages-container {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }

    .message-list {
      width: 260px;
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      min-width: 200px;
    }

    .message-list h2 {
      margin: 0 0 12px 0;
      font-size: 18px;
      color: var(--primary);
      font-family: var(--heading-font);
    }

    .message-list ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .message-list li {
      padding: 10px 8px;
      cursor: pointer;
      color: var(--foreground);
      transition: background 0.2s ease;
      font-family: var(--body-font);
      border-radius: 10px;
    }

    .message-list li:hover,
    .message-list li.active {
      background: #e0e7ff;
      color: var(--primary);
    }

    .message-box {
      flex: 1;
      background: var(--secondary);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      display: flex;
      flex-direction: column;
      min-width: 260px;
    }

    .chat-window {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--card);
      min-height: 120px;
    }

    .message {
      margin-bottom: 10px;
      font-size: 15px;
      font-family: var(--body-font);
    }

    .message.sent {
      text-align: right;
      color: var(--primary);
    }

    .message.received {
      text-align: left;
      color: var(--foreground);
    }

    #message-input {
      width: calc(100% - 80px);
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      font-family: var(--body-font);
      background: var(--background);
      color: var(--foreground);
    }

    #message-form {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    #message-form button {
      width: 70px;
      background-color: var(--primary);
    }

    .viewing-actions {
      margin-top: 18px;
    }

    .viewing-actions button {
      background: var(--primary);
      color: #ffffff;
      width: auto;
      padding: 10px 22px;
    }

    .viewing-actions button:disabled {
      background: #a5b4fc;
      cursor: not-allowed;
    }

    .viewing-actions .status-message {
      margin-bottom: 10px;
      color: var(--primary);
      font-weight: 500;
      font-family: var(--body-font);
    }

    .viewing-actions .contract-message {
      margin-top: 10px;
      color: var(--accent);
      font-weight: 500;
      font-family: var(--body-font);
    }

    .applicants-section {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 32px;
      margin-bottom: 32px;
    }

    .applicants-section h2 {
      color: var(--primary);
      margin-bottom: 18px;
      font-size: 22px;
      font-family: var(--heading-font);
    }

    .applicants-section label {
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
    }

    .applicants-section input[type="text"] {
      width: 240px;
      padding: 8px;
      margin-right: 8px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
    }

    .applicants-section button {
      width: auto;
      padding: 8px 18px;
      margin-top: 0;
      background-color: var(--primary);
      color: #ffffff;
    }

    .applicants-section button:hover {
      opacity: 0.9;
    }

    .applicants-section table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 18px;
    }

    .applicants-section th,
    .applicants-section td {
      border: 1px solid var(--border);
      padding: 10px 8px;
      text-align: left;
    }

    .applicants-section th {
      background: #f3f4f6;
      color: var(--primary);
    }

    .applicants-section tr:nth-child(even) {
      background: #f9fafb;
    }

    .applicants-section tr:hover {
      background: #e0f2fe;
    }

    .applicants-section #status {
      margin-top: 10px;
      color: var(--primary);
      font-size: 15px;
    }

    .compare-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .compare-modal.active {
      display: flex;
    }

    .compare-content {
      background: #ffffff;
      max-width: 700px;
      min-width: 320px;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }

    .compare-header {
      background: var(--primary);
      color: #ffffff;
      padding: 15px;
      font-size: 18px;
      font-weight: 600;
      position: relative;
      border-radius: 12px;
      text-align: center;
    }

    .compare-header .close-button {
      position: absolute;
      top: 50%;
      right: 15px;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 20px;
      color: #ffffff;
      cursor: pointer;
    }

    .compare-header .close-button:hover {
      color: #f87171;
    }

    .compare-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 0.98rem;
    }

    .compare-table th,
    .compare-table td {
      border: 1px solid var(--border);
      padding: 8px 6px;
      text-align: left;
    }

    .compare-table th {
      background: #f3f4f6;
      color: var(--primary);
    }

    .compare-table tr:nth-child(even) {
      background: #f9fafb;
    }

    .compare-table tr:hover {
      background: #e0f2fe;
    }

    .payment-section {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 32px;
      margin-bottom: 32px;
    }

    .payment-section h2 {
      color: var(--primary);
      margin-bottom: 20px;
      font-family: var(--heading-font);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .payment-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .payment-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      color: #ffffff;
      padding: 24px;
      border-radius: 18px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
    }

    .payment-card h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      opacity: 0.9;
    }

    .payment-card .amount {
      font-size: 28px;
      font-weight: 600;
      margin: 0;
    }

    .payment-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .payment-btn {
      background: var(--primary);
      color: #ffffff;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .payment-btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }

    .payment-btn.success {
      background: #10b981;
    }

    .payment-btn.success:hover {
      background: #059669;
    }

    .payment-history {
      background: var(--secondary);
      border-radius: 14px;
      padding: 20px;
      margin-top: 20px;
    }

    .payment-history h3 {
      margin: 0 0 16px 0;
      color: var(--primary);
    }

    .payment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .payment-item:last-child {
      border-bottom: none;
    }

    .payment-item .date {
      color: var(--muted);
      font-size: 14px;
    }

    .payment-item .amount {
      font-weight: 600;
      color: var(--primary);
    }

    .payment-status {
      padding: 4px 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      border-radius: 10px;
    }

    .payment-status.completed {
      background: #dcfce7;
      color: #166534;
    }

    .payment-status.pending {
      background: #fef3c7;
      color: #92400e;
    }

    .payment-status.failed {
      background: #fee2e2;
      color: #dc2626;
    }

    .footer {
      background: #ffffff;
      border-top: 1px solid var(--border);
      text-align: center;
      padding: 28px 10px 18px 10px;
      font-size: 16px;
      color: var(--muted);
      margin-top: auto;
      box-shadow: 0 -2px 12px rgba(0,0,0,0.03);
    }

    .footer a {
      color: var(--primary);
      text-decoration: none;
      margin: 0 8px;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    .footer a:hover {
      color: #134cca;
      text-decoration: underline;
    }

    @media (max-width: 900px) {
      .dashboard-cards {
        flex-direction: column;
        gap: 16px;
      }

      .main-content {
        padding: 24px 8px;
      }

      .sidebar {
        width: 100px;
        padding: 16px 0 0 0;
      }

      .sidebar h2 {
        font-size: 16px;
        margin-left: 12px;
      }

      .sidebar-nav a {
        font-size: 13px;
        padding: 10px 12px;
        gap: 8px;
      }

      .applicants-section input[type="text"] {
        width: 100%;
        margin-bottom: 8px;
      }

      .footer {
        font-size: 14px;
        padding: 18px 4px 12px 4px;
      }
    }

    header {
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 0 40px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
    }

    .sichrplace-text {
      font-family: var(--heading-font);
      font-weight: 700;
      font-size: 1.4rem;
      color: var(--primary);
      line-height: 1;
    }

    .certified-badge {
      font-size: 0.8rem;
      color: var(--accent);
      font-weight: 600;
      margin-top: 2px;
    }

    .logo img {
      height: 40px;
      width: auto;
      filter: drop-shadow(0 1px 3px rgba(0,0,0,0.1));
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: var(--heading-font);
      font-weight: 600;
      font-size: 1.5rem;
      color: var(--primary);
      text-decoration: none;
      background: transparent;
      padding: 0;
      border-radius: 0;
      border: none;
      box-shadow: none;
    }

    header nav {
      display: flex;
      gap: 24px;
      align-items: center;
      position: relative;
    }

    header nav a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      font-family: var(--heading-font);
      font-size: 1rem;
      transition: color 0.2s ease;
    }

    header nav a:hover {
      color: var(--accent);
    }

    .cart-icon {
      display: flex !important;
      align-items: center;
      justify-content: center;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.3s ease;
      position: relative;
    }

    .cart-icon:hover {
      background: var(--primary) !important;
      color: #ffffff !important;
      transform: translateY(-2px);
    }

    .cart-icon i {
      font-size: 1.1rem;
    }

    .smart-matching-section {
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 32px;
      border-radius: var(--radius);
      margin-bottom: 32px;
    }

    .smart-matching-section h2 {
      margin-top: 0;
      font-size: 1.6rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .smart-matching-intro {
      color: var(--muted);
      margin-bottom: 20px;
    }

    .smart-matching-grid {
      display: grid;
      gap: 24px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .smart-matching-column {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .smart-match-list {
      display: grid;
      gap: 16px;
    }

    .smart-match-list.smart-match-list-loading::after {
      content: "â³ Suche laufend â€¦";
      text-align: center;
      color: var(--muted);
      font-style: italic;
    }

    .smart-match-card {
      background: var(--secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }

    .smart-match-card-header {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .smart-match-card-header > div {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .smart-match-score {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #eef2ff;
      color: var(--primary);
      border-radius: 12px;
      padding: 6px 12px;
      font-weight: 700;
      min-width: 56px;
    }

    .smart-match-contact {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .smart-match-location {
      color: var(--muted);
      margin: 0;
    }

    .smart-match-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .smart-match-insights {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .smart-match-footer {
      display: flex;
      justify-content: flex-end;
    }

    .smart-match-action {
      background: var(--primary);
      color: #ffffff;
      border: none;
      padding: 8px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: opacity 0.2s ease;
    }

    .smart-match-action:hover {
      opacity: 0.85;
    }

    .smart-matching-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .smart-matching-form label {
      font-weight: 600;
      color: var(--foreground);
    }

    .smart-matching-form input,
    .smart-matching-form select,
    .smart-matching-form textarea {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      font-family: var(--body-font);
      font-size: 0.95rem;
      background: var(--secondary);
    }

    .smart-matching-form textarea {
      min-height: 90px;
      resize: vertical;
    }

    .smart-matching-form button {
      align-self: flex-start;
      background: var(--primary);
      color: #ffffff;
      border: none;
      padding: 10px 18px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: opacity 0.2s ease;
    }

    .smart-matching-form button:hover {
      opacity: 0.9;
    }

    .smart-matching-alert {
      display: none;
    }

    .smart-matching-alert-message {
      border-radius: 12px;
      padding: 12px 16px;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .smart-matching-alert-info {
      background: #e0f2fe;
      color: #0369a1;
    }

    .smart-matching-alert-success {
      background: #dcfce7;
      color: #15803d;
    }

    .smart-matching-alert-warning {
      background: #fef3c7;
      color: #b45309;
    }

    .smart-matching-alert-error {
      background: #fee2e2;
      color: #b91c1c;
    }

    .smart-matching-budget {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
    }
  </style>
  <script src="js/translation-handler.js" defer></script>
    <script src="js/logo-cookie-manager.js" defer></script>
</head>
<body>
  <header>
    <div class="header-logo">
      <a href="index.html" class="logo" aria-label="SichrPlace">
        <img src="img/sichrplace-logo.jpg" alt="SichrPlace logo" style="height:48px;width:auto;display:block;">
        <span class="brand-text">
          <span class="sichrplace-text">SichrPlace</span>
          <span class="certified-badge" style="display:none;">Verified</span>
        </span>
      </a>
    </div>
    <button class="menu-toggle" id="menu-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <span class="menu-bar"></span>
      <span class="menu-bar"></span>
      <span class="menu-bar"></span>
    </button>
    <nav class="main-nav" id="main-nav">
      <a href="login.html" data-translate="nav.login">Login</a>
      <a href="apartments-listing.html" data-translate="nav.apartments">Apartments</a>
      
      <!-- View link for viewing requests -->
      <a href="viewing-request.html" data-translate="nav.view">View</a>
      
      <!-- Marketplace Cart Icon - Enhanced Visibility -->
      <a href="marketplace.html" class="cart-icon" title="Marketplace - Buy & Sell" aria-label="Marketplace" data-translate-title="nav.marketplace.title" data-translate-aria="nav.marketplace.aria">
        <svg class="cart-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M7.01 18.5a1.5 1.5 0 1 1-2.999.001 1.5 1.5 0 0 1 2.999-.001Zm10 0a1.5 1.5 0 1 1-3.001 0 1.5 1.5 0 0 1 3.001 0ZM6.16 7l.44 2h11.56a1 1 0 0 1 .98 1.204l-1.2 6a1 1 0 0 1-.98.796H8.18a1 1 0 0 1-.98-.804L5.53 4.5H3a1 1 0 1 1 0-2h3a1 1 0 0 1 .98.804L7.62 7H6.16Z" fill="currentColor" />
        </svg>
        <span class="cart-label" data-translate="nav.marketplace.label">Marketplace</span>
      </a>
      
      <!-- Language Switcher moved to the rightmost position -->
      <div class="language-switcher">
        <button class="language-btn" id="language-btn" aria-label="Switch Language">
          <i class="fas fa-globe"></i>
          <span id="current-lang">EN</span>
          <i class="fas fa-chevron-down"></i>
        </button>
        <div class="language-dropdown" id="language-dropdown">
          <a href="#" data-lang="en" class="lang-option active">
            <span class="flag-emoji">ðŸ‡ºðŸ‡¸</span>
            English
          </a>
          <a href="#" data-lang="de" class="lang-option">
            <span class="flag-emoji">ðŸ‡©ðŸ‡ª</span>
            Deutsch
          </a>
          <a href="#" data-lang="tr" class="lang-option">
            <span class="flag-emoji">ðŸ‡¹ðŸ‡·</span>
            TÃ¼rkÃ§e
          </a>
        </div>
      </div>
    </nav>
  </header>
  
  <div class="dashboard-root">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2 style="display: flex; align-items: center; gap: 8px; margin-left: 12px;">

      </h2>
      <nav class="sidebar-nav">
        <a href="#" id="profile-link" class="active"><i class="fa fa-user"></i> Profile</a>
        <a href="#" id="listedApartments-link"><i class="fa fa-building"></i> Listed Apartments</a>
        <a href="#" id="payments-link"><i class="fa fa-credit-card"></i> Payments</a>
        <a href="#" id="messages-link"><i class="fa fa-comments"></i> Messages</a>
        <a href="#" id="viewingRequests-link"><i class="fa fa-calendar-check"></i> Viewing Requests</a>
        <a href="#" id="applicants-link"><i class="fa fa-users"></i> Applicants</a>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="main-content">
      <section class="smart-matching-section" id="landlord-smart-matching">
        <h2><i class="fa fa-bullseye"></i> Smart Matching</h2>
        <p class="smart-matching-intro">Review automatically ranked tenants that fit your listings and fine-tune the matching filters to attract the right audience.</p>
        <div id="landlord-matching-alert" class="smart-matching-alert"></div>
        <div class="smart-matching-grid">
          <div class="smart-matching-column">
            <h3>Qualified Tenants</h3>
            <div id="landlord-match-list" class="smart-match-list"></div>
          </div>
          <div class="smart-matching-column">
            <h3>Match Filters</h3>
            <form id="landlord-preferences-form" class="smart-matching-form">
              <div>
                <label for="landlordBudgetMin">Preferred Rent Range (â‚¬)</label>
                <div class="smart-matching-budget">
                  <input type="number" id="landlordBudgetMin" name="budgetMin" min="0" placeholder="Min">
                  <input type="number" id="landlordBudgetMax" name="budgetMax" min="0" placeholder="Max">
                </div>
              </div>
              <div>
                <label for="landlordPreferredCities">Focus Cities</label>
                <input type="text" id="landlordPreferredCities" name="preferredCities" placeholder="Berlin, Hamburg">
              </div>
              <div>
                <label for="landlordPropertyTypes">Property Types</label>
                <input type="text" id="landlordPropertyTypes" name="propertyTypes" placeholder="Apartment, Loft">
              </div>
              <div>
                <label for="landlordAmenities">Key Amenities</label>
                <textarea id="landlordAmenities" name="amenities" placeholder="Balcony, Parking"></textarea>
              </div>
              <div>
                <label for="landlordMaxDistance">Max Distance (km)</label>
                <input type="number" id="landlordMaxDistance" name="maxDistanceKm" min="0" placeholder="10">
              </div>
              <div>
                <label for="landlordPetFriendly">Pet Policy</label>
                <select id="landlordPetFriendly" name="petFriendly">
                  <option value="">No preference</option>
                  <option value="true">Pets allowed</option>
                  <option value="false">No pets</option>
                </select>
              </div>
              <div>
                <label for="landlordFurnished">Furnishing</label>
                <select id="landlordFurnished" name="furnished">
                  <option value="">No preference</option>
                  <option value="true">Furnished</option>
                  <option value="false">Unfurnished</option>
                </select>
              </div>
              <button type="submit"><i class="fa fa-filter"></i> Save Filters</button>
            </form>
          </div>
        </div>
      </section>
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <h3><i class="fa fa-building"></i> Listed Apartments</h3>
          <p>Manage your current apartment listings and create new offers.</p>
        </div>
        <div class="dashboard-card">
          <h3><i class="fa fa-calendar-check"></i> Viewing Requests</h3>
          <p>Review and respond to apartment viewing requests from applicants.</p>
        </div>
        <div class="dashboard-card">
          <h3><i class="fa fa-comments"></i> Messages</h3>
          <p>Communicate with applicants and manage your conversations.</p>
        </div>
        <!-- Viewing Agreement & Contract Generation for Landlord -->
        <div class="dashboard-card">
          <h3><i class="fa fa-handshake"></i> Viewing & Contract</h3>
          <p>When you and the renter agree to a viewing, assign a customer manager and generate a digital contract.</p>
          <div class="viewing-actions">
            <button id="proceed-viewing-btn">
              Proceed to Viewing
            </button>
            <div id="viewing-status"></div>
          </div>
        </div>
      </div>
      <h1>Profile</h1>
        <div class="form-container">
        <h2>Update Your Profile</h2>
        <form id="profile-form" action="/api/update-landlord-profile" method="POST" enctype="multipart/form-data">
          <label for="photo">Profile Photo:</label>
          <input type="file" id="photo" name="photo" accept="image/*">

          <label for="full-name">Full Name:</label>
          <input type="text" id="full-name" name="full-name" placeholder="Enter your full name" required>

          <label for="email">Email Address:</label>
          <input type="email" id="email" name="email" placeholder="Enter your email address" required>

          <label for="platform-id">Platform ID:</label>
          <input type="text" id="platform-id" name="platform-id" value="LLD-654321" readonly style="background:#f3f4f6;">

          <label for="id-document">Upload ID Document (PDF, JPG, PNG):</label>
          <input type="file" id="id-document" name="id-document" accept=".pdf,image/*" required>

          <label for="selfie">Upload Selfie or Video for Verification:</label>
          <input type="file" id="selfie" name="selfie" accept="image/*,video/*" required>

          <label for="telefon">Telephone Number:</label>
          <input type="tel" id="telefon" name="telefon" placeholder="Enter your phone number" required>

          <label for="company">Company (if applicable):</label>
          <input type="text" id="company" name="company" placeholder="Enter your company name">

          <label for="address">Address:</label>
          <input type="text" id="address" name="address" placeholder="Enter your address">

          <button type="submit">Save Changes</button>
        </form>
      </div>
      <!-- Applicants Table Section -->
      <div class="applicants-section" id="applicants-section">
        <h2>Applicants for Apartment</h2>
        <label for="apartment-id">Apartment ID:</label>
        <input type="text" id="apartment-id" placeholder="Enter Apartment ID">
        <button onclick="loadApplicants()">Load Applicants</button>
        <!-- Compare Applicants Button -->
        <button id="compare-applicants-btn" style="margin-bottom:12px;background:#2563EB;color:#fff;border:none;border-radius:4px;padding:10px 18px;font-size:15px;cursor:pointer;">
          <i class="fa fa-users"></i> Compare Applicants
        </button>
        <table id="applicants-table">
          <thead>
            <tr>
              <th>Name(s)</th>
              <th>Move-in</th>
              <th>Move-out</th>
              <th>Reason</th>
              <th>Habits/Personality</th>
              <th>Payer</th>
            </tr>
          </thead>
          <tbody>
            <!-- Filled by JS -->
          </tbody>
        </table>
        <div id="status"></div>
      </div>
      <!-- Compare Applicants Modal -->
      <div id="compare-modal" class="compare-modal">
        <div class="compare-content">
          <div class="compare-header">
            Compare Applicants
            <button class="close-button" onclick="closeCompareModal()">&times;</button>
          </div>
          <table class="compare-table" id="compare-table">
            <thead>
              <tr>
                <th>Name(s)</th>
                <th>Move-in</th>
                <th>Move-out</th>
                <th>Reason</th>
                <th>Habits/Personality</th>
                <th>Payer</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
      </div>
      <!-- Messages Section -->
      <div class="messages-section" id="messages-section" style="display:none;">
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <h3><i class="fa fa-comments"></i> Messages</h3>
            <p>Communicate with applicants and manage your conversations.</p>
          </div>
        </div>
        <h1>Messages</h1>
        <div class="messages-container">
          <div class="message-list">
            <h2>Conversations</h2>
            <ul id="conversation-list">
              <!-- Conversations will be dynamically loaded here -->
            </ul>
          </div>
          <div class="message-box">
            <h2>Chat</h2>
            <div id="chat-window" class="chat-window">
              <!-- Messages will be dynamically loaded here -->
            </div>
            <form id="message-form">
              <input type="text" id="message-input" placeholder="Type your message..." required>
              <button type="submit">Send</button>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Payments Section -->
      <div class="payments-section" id="payments-section" style="display:none;">
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <h3><i class="fa fa-credit-card"></i> Payment Management</h3>
            <p>Manage rent payments, deposits, and financial transactions.</p>
          </div>
        </div>
        
        <!-- Payment Dashboard Cards -->
        <div class="payment-cards">
          <div class="payment-card">
            <h3>Monthly Revenue</h3>
            <div class="payment-amount">â‚¬3,450</div>
            <p class="payment-period">March 2024</p>
          </div>
          <div class="payment-card">
            <h3>Pending Payments</h3>
            <div class="payment-amount">â‚¬850</div>
            <p class="payment-period">2 tenants</p>
          </div>
          <div class="payment-card">
            <h3>Total Earnings</h3>
            <div class="payment-amount">â‚¬28,760</div>
            <p class="payment-period">This year</p>
          </div>
        </div>

        <!-- Payment Actions -->
        <div class="payment-section">
          <h3>Quick Actions</h3>
          <div class="payment-actions">
            <button class="payment-btn primary" onclick="requestPayment()">
              <i class="fa fa-money"></i> Request Payment
            </button>
            <button class="payment-btn secondary" onclick="setupAutoPay()">
              <i class="fa fa-refresh"></i> Setup Auto-Payment
            </button>
            <button class="payment-btn tertiary" onclick="withdrawFunds()">
              <i class="fa fa-bank"></i> Withdraw to Bank
            </button>
          </div>
        </div>

        <!-- Premium Features Section -->
        <div class="payment-section">
          <h3>ðŸŒŸ Premium Features</h3>
          <div class="payment-cards">
            <div class="payment-card">
              <h4>Featured Listing</h4>
              <div class="payment-amount">â‚¬19.99</div>
              <p class="payment-period">30 days</p>
              <div id="featured-listing-paypal" style="margin-top: 16px;"></div>
            </div>
            <div class="payment-card">
              <h4>Priority Support</h4>
              <div class="payment-amount">â‚¬9.99</div>
              <p class="payment-period">per month</p>
              <div id="priority-support-paypal" style="margin-top: 16px;"></div>
            </div>
            <div class="payment-card">
              <h4>Analytics Plus</h4>
              <div class="payment-amount">â‚¬14.99</div>
              <p class="payment-period">per month</p>
              <div id="analytics-plus-paypal" style="margin-top: 16px;"></div>
            </div>
          </div>
        </div>

        <!-- Payment History -->
        <div class="payment-section">
          <h3>Recent Transactions</h3>
          <div class="payment-history">
            <div class="payment-item">
              <div class="payment-info">
                <h4>Rent Payment - Studio Apartment</h4>
                <p>From: Sarah MÃ¼ller</p>
                <small>March 15, 2024, 10:30 AM</small>
              </div>
              <div class="payment-details">
                <span class="payment-amount">â‚¬750.00</span>
                <span class="payment-status completed">Completed</span>
              </div>
            </div>
            
            <div class="payment-item">
              <div class="payment-info">
                <h4>Security Deposit</h4>
                <p>From: Mark Johnson</p>
                <small>March 12, 2024, 2:15 PM</small>
              </div>
              <div class="payment-details">
                <span class="payment-amount">â‚¬1,500.00</span>
                <span class="payment-status completed">Completed</span>
              </div>
            </div>
            
            <div class="payment-item">
              <div class="payment-info">
                <h4>Viewing Fee</h4>
                <p>From: Anna Schmidt</p>
                <small>March 10, 2024, 4:45 PM</small>
              </div>
              <div class="payment-details">
                <span class="payment-amount">â‚¬25.00</span>
                <span class="payment-status pending">Pending</span>
              </div>
            </div>
            
            <div class="payment-item">
              <div class="payment-info">
                <h4>Monthly Rent</h4>
                <p>From: Tom Weber</p>
                <small>March 8, 2024, 9:20 AM</small>
              </div>
              <div class="payment-details">
                <span class="payment-amount">â‚¬1,200.00</span>
                <span class="payment-status failed">Failed</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Tenant Payment Setup -->
        <div class="payment-section">
          <h3>Tenant Payment Setup</h3>
          <p>Help your tenants set up automatic payments for a smoother rental experience.</p>
          <button class="payment-btn secondary" onclick="sendPaymentLinks()">
            <i class="fa fa-link"></i> Send Payment Links to Tenants
          </button>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer">
    <p>&copy; 2025 SichrPlace. All rights reserved.</p>
    <p>
      <a href="https://sichrplace.com/privacy-policy">Privacy Policy</a> |
      <a href="https://sichrplace.com/terms-of-service">Terms of Service</a>
    </p>
  </footer>
  <script>
    // Content for each section
    const content = {
      profile: document.querySelector('.main-content').innerHTML,
      listedApartments: `
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <h3><i class="fa fa-building"></i> Listed Apartments</h3>
            <p>Manage your current apartment listings and create new offers.</p>
          </div>
        </div>
        <h1>Listed Apartments</h1>
        <div class="offer-actions">
          <button id="browse-apartments">Browse Apartments</button>
          <button id="create-apartment">Create Apartment Offer</button>
        </div>
      `,
      payments: document.getElementById('payments-section').outerHTML,
      messages: document.getElementById('messages-section').outerHTML,
      viewingRequests: `
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <h3><i class="fa fa-calendar-check"></i> Viewing Requests</h3>
            <p>Review and respond to apartment viewing requests from applicants.</p>
          </div>
        </div>
        <h1>Viewing Requests</h1>
        <div class="form-container">
          <h2>Manage Viewing Requests</h2>
          <ul id="viewing-requests-list">
            <!-- Viewing requests will be dynamically loaded here -->
            <li>Request 1: Applicant Name - Date/Time <button>Approve</button> <button>Reject</button></li>
            <li>Request 2: Applicant Name - Date/Time <button>Approve</button> <button>Reject</button></li>
          </ul>
        </div>
      `,
      applicants: `
        <div class="applicants-section" id="applicants-section">
          <h2>Applicants for Apartment</h2>
          <label for="apartment-id">Apartment ID:</label>
          <input type="text" id="apartment-id" placeholder="Enter Apartment ID">
          <button onclick="loadApplicants()">Load Applicants</button>
          <button id="compare-applicants-btn" style="margin-bottom:12px;background:#2563EB;color:#fff;border:none;border-radius:4px;padding:10px 18px;font-size:15px;cursor:pointer;">
            <i class="fa fa-users"></i> Compare Applicants
          </button>
          <table id="applicants-table">
            <thead>
              <tr>
                <th>Name(s)</th>
                <th>Move-in</th>
                <th>Move-out</th>
                <th>Reason</th>
                <th>Habits/Personality</th>
                <th>Payer</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filled by JS -->
            </tbody>
          </table>
          <div id="status"></div>
        </div>
        <div id="compare-modal" class="compare-modal">
          <div class="compare-content">
            <div class="compare-header">
              Compare Applicants
              <button class="close-button" onclick="closeCompareModal()">&times;</button>
            </div>
            <table class="compare-table" id="compare-table">
              <thead>
                <tr>
                  <th>Name(s)</th>
                  <th>Move-in</th>
                  <th>Move-out</th>
                  <th>Reason</th>
                  <th>Habits/Personality</th>
                  <th>Payer</th>
                </tr>
              </thead>
              <tbody>
                <!-- Filled by JS -->
              </tbody>
            </table>
          </div>
        </div>
      `
    };

    // Add click event listeners to sidebar links
    const links = document.querySelectorAll('.sidebar-nav a');
    const mainContent = document.getElementById('main-content');

    links.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();

        // Remove active class from all links
        links.forEach(l => l.classList.remove('active'));

        // Add active class to the clicked link
        link.classList.add('active');

        // Update main content based on the clicked link
        const section = link.id.replace('-link', '');
        if (section === 'messages') {
          // Show messages section and hide others
          document.getElementById('messages-section').style.display = '';
          document.getElementById('payments-section').style.display = 'none';
          document.querySelectorAll('.main-content > :not(.messages-section):not(.payments-section)').forEach(el => el.style.display = 'none');
          loadConversations();
        } else if (section === 'payments') {
          // Show payments section and hide others
          document.getElementById('payments-section').style.display = '';
          document.getElementById('messages-section').style.display = 'none';
          document.querySelectorAll('.main-content > :not(.messages-section):not(.payments-section)').forEach(el => el.style.display = 'none');
        } else {
          // Hide messages and payments sections and show others
          document.getElementById('messages-section').style.display = 'none';
          document.getElementById('payments-section').style.display = 'none';
          document.querySelectorAll('.main-content > :not(.messages-section):not(.payments-section)').forEach(el => el.style.display = '');
          if (content[section]) {
            mainContent.innerHTML = content[section];
          }
        }

        // Initialize functionality for specific sections
        if (section === 'listedApartments') {
          document.getElementById('browse-apartments').addEventListener('click', () => {
            window.location.href = 'apartments-listing.html';
          });
          document.getElementById('create-apartment').addEventListener('click', () => {
            window.location.href = 'add-property.html';
          });
        }

        // Re-initialize Viewing Agreement & Contract Generation logic if on dashboard
        if (section === 'profile' || section === '') {
          setupViewingAgreement();
        }

        // Initialize applicants table logic if on applicants section
        if (section === 'applicants' || section === 'profile') {
          setTimeout(() => {
            setupApplicantsTable();
            setupCompareApplicants();
          }, 0);
        }
      });
    });

    // Viewing Agreement & Contract Generation logic
    function setupViewingAgreement() {
      const proceedBtn = document.getElementById('proceed-viewing-btn');
      const viewingStatus = document.getElementById('viewing-status');
      if (proceedBtn && viewingStatus) {
        proceedBtn.disabled = false;
        viewingStatus.innerHTML = '';
        proceedBtn.addEventListener('click', function handler() {
          proceedBtn.disabled = true;
          viewingStatus.innerHTML = `
            <div class="status-message">
              <i class="fa fa-user-tie"></i>
              <span style="margin-left:6px;">Customer manager assigned. Apartment video will be created and sent to the applicant.</span>
            </div>
            <button id="generate-contract-btn" style="background:#10B981;color:#fff;border:none;padding:8px 20px;border-radius:8px;cursor:pointer;font-weight:600;">
              Generate Contract
            </button>
            <div id="contract-status"></div>
          `;
          const generateBtn = document.getElementById('generate-contract-btn');
          const contractStatus = document.getElementById('contract-status');
          if (generateBtn && contractStatus) {
            generateBtn.addEventListener('click', function() {
              generateBtn.disabled = true;
              contractStatus.innerHTML = `
                <div class="contract-message">
                  <i class="fa fa-file-signature"></i>
                  <span style="margin-left:6px;">Digital contract generated! Both parties can now sign online.</span>
                </div>
              `;
            });
          }
          // Remove this handler after first click to prevent multiple event bindings
          proceedBtn.removeEventListener('click', handler);
        });
      }
    }

    // Applicants Table Logic
    function setupApplicantsTable() {
      const loadBtn = document.querySelector('#applicants-section button');
      if (loadBtn) {
        loadBtn.onclick = loadApplicants;
      }
    }

    async function loadApplicants() {
      const apartmentIdInput = document.getElementById('apartment-id');
      const status = document.getElementById('status');
      const tbody = document.querySelector('#applicants-table tbody');
      tbody.innerHTML = '';
      const apartmentId = apartmentIdInput.value.trim();
      if (!apartmentId) {
        status.textContent = "Please enter an Apartment ID.";
        return;
      }
      status.textContent = "Loading...";
      try {
        const res = await fetch(`http://localhost:3000/api/booking-requests/${apartmentId}`);
        const applicants = await res.json();
        if (!Array.isArray(applicants) || applicants.length === 0) {
          status.textContent = "No applicants found for this apartment.";
          return;
        }
        status.textContent = "";
        applicants.forEach(app => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${app.tenant_names || ''}</td>
            <td>${app.move_in || ''}</td>
            <td>${app.move_out || ''}</td>
            <td>${app.reason || ''}</td>
            <td>${app.habits || ''}</td>
            <td>${app.payer || ''}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        status.textContent = "Error loading applicants.";
      }
    }

    // Compare Applicants Logic
    function setupCompareApplicants() {
      const compareBtn = document.getElementById('compare-applicants-btn');
      const compareModal = document.getElementById('compare-modal');
      if (compareBtn && compareModal) {
        compareBtn.onclick = function() {
          compareModal.classList.add('active');
          renderCompareTable();
        };
      }
    }

    function closeCompareModal() {
      const compareModal = document.getElementById('compare-modal');
      if (compareModal) {
        compareModal.classList.remove('active');
      }
    }

    function renderCompareTable() {
      const tbody = document.getElementById('compare-table').querySelector('tbody');
      tbody.innerHTML = '';
      // Use the same applicants loaded in your applicants table
      const applicants = [];
      document.querySelectorAll('#applicants-table tbody tr').forEach(tr => {
        const tds = tr.querySelectorAll('td');
        if (tds.length) {
          applicants.push(Array.from(tds).map(td => td.textContent));
        }
      });
      if (applicants.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.textContent = "No applicants to compare.";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      applicants.forEach(app => {
        const tr = document.createElement('tr');
        tr.innerHTML = app.map(val => `<td>${val}</td>`).join('');
        tbody.appendChild(tr);
      });
    }

    // Messaging logic (frontend integration)
    function loadConversations() {
      const conversationList = document.getElementById('conversation-list');
      const chatWindow = document.getElementById('chat-window');
      const messageForm = document.getElementById('message-form');
      const messageInput = document.getElementById('message-input');

      // For demo, use a static landlordId. Replace with actual user session/userId in production.
      const userId = "landlord1";

      async function fetchConversations() {
        try {
          const response = await fetch(`/api/conversations/${userId}`);
          if (!response.ok) throw new Error('Failed to load conversations');
          const conversations = await response.json();
          if (!Array.isArray(conversations) || conversations.length === 0) {
            conversationList.innerHTML = '<li>No conversations found.</li>';
            chatWindow.innerHTML = '';
            return;
          }
          conversationList.innerHTML = conversations.map(convo => `
            <li data-id="${convo.id}" class="conversation-item">${convo.name}</li>
          `).join('');
          document.querySelectorAll('.conversation-item').forEach(item => {
            item.addEventListener('click', () => {
              document.querySelectorAll('.conversation-item').forEach(i => i.classList.remove('active'));
              item.classList.add('active');
              loadMessages(item.getAttribute('data-id'));
            });
          });
          // Auto-select the first conversation
          const first = document.querySelector('.conversation-item');
          if (first) {
            first.classList.add('active');
            loadMessages(first.getAttribute('data-id'));
          }
        } catch (error) {
          conversationList.innerHTML = '<li>Failed to load conversations.</li>';
          chatWindow.innerHTML = '';
        }
      }

      async function loadMessages(conversationId) {
        try {
          const response = await fetch(`/api/messages/${conversationId}`);
          if (!response.ok) throw new Error('Failed to load messages');
          const messages = await response.json();
          chatWindow.innerHTML = messages.map(msg => `
            <div class="message ${msg.sender === userId ? 'sent' : 'received'}">
              <p><strong>${msg.sender}:</strong> ${msg.message}</p>
            </div>
          `).join('');
          chatWindow.scrollTop = chatWindow.scrollHeight;
        } catch (error) {
          chatWindow.innerHTML = '<p>Failed to load messages. Please try again later.</p>';
        }
      }

      if (messageForm) {
        messageForm.onsubmit = async (e) => {
          e.preventDefault();
          const newMessage = messageInput.value.trim();
          const activeConversation = document.querySelector('.conversation-item.active');
          const conversationId = activeConversation ? activeConversation.getAttribute('data-id') : null;
          if (newMessage && conversationId) {
            // Optimistically add message to chat
            chatWindow.innerHTML += `
              <div class="message sent">
                <p><strong>${userId}:</strong> ${newMessage}</p>
              </div>
            `;
            chatWindow.scrollTop = chatWindow.scrollHeight;
            messageInput.value = '';
            try {
              const response = await fetch('/api/send-message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  conversationId,
                  sender: userId,
                  message: newMessage,
                }),
              });
              if (!response.ok) throw new Error('Failed to send the message');
              // Optionally reload messages to get the latest from server
              // await loadMessages(conversationId);
            } catch (error) {
              alert('Failed to send the message. Please try again.');
            }
          }
        };
      }

      fetchConversations();
    }

    // Payment Functions
    const stripe = Stripe('pk_test_51234567890'); // Replace with your actual Stripe publishable key

    function requestPayment() {
      // Create a modal for payment request
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.7); display: flex; align-items: center;
        justify-content: center; z-index: 1000;
      `;
      
      modal.innerHTML = `
        <div style="background: white; padding: 30px; max-width: 500px; width: 90%; border-radius: 16px;">
          <h3 style="margin: 0 0 20px 0; color: #2563EB;">Request Payment</h3>
          <form id="payment-request-form">
            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 500;">Tenant Email:</label>
              <input type="email" id="tenant-email" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 500;">Payment Type:</label>
              <select id="payment-type" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                <option value="">Select payment type</option>
                <option value="rent">Monthly Rent</option>
                <option value="deposit">Security Deposit</option>
                <option value="viewing-fee">Viewing Fee</option>
                <option value="utilities">Utilities</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 500;">Amount (â‚¬):</label>
              <input type="number" id="payment-amount" step="0.01" min="1" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 500;">Description:</label>
              <textarea id="payment-description" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; height: 80px;" placeholder="Optional description..."></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
              <button type="submit" style="flex: 1; padding: 12px; background: #2563EB; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Send Payment Request
              </button>
              <button type="button" onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="flex: 1; padding: 12px; background: #6B7280; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Cancel
              </button>
            </div>
          </form>
        </div>
      `;

      document.body.appendChild(modal);

      // Handle form submission
      document.getElementById('payment-request-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = {
          tenantEmail: document.getElementById('tenant-email').value,
          paymentType: document.getElementById('payment-type').value,
          amount: document.getElementById('payment-amount').value,
          description: document.getElementById('payment-description').value
        };

        try {
          // Here you would typically send this to your backend
          console.log('Payment request:', formData);
          alert('Payment request sent successfully!');
          modal.remove();
          
          // Add to payment history (simulated)
          addPaymentToHistory({
            type: formData.paymentType,
            amount: formData.amount,
            tenant: formData.tenantEmail,
            status: 'pending',
            date: new Date().toLocaleString()
          });
        } catch (error) {
          console.error('Error sending payment request:', error);
          alert('Error sending payment request. Please try again.');
        }
      });
    }

    function setupAutoPay() {
      alert('Auto-payment setup will be implemented with your payment processor integration.');
      // This would integrate with your payment processor's recurring payment setup
    }

    function withdrawFunds() {
      // Create withdrawal modal
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.7); display: flex; align-items: center;
        justify-content: center; z-index: 1000;
      `;
      
      modal.innerHTML = `
        <div style="background: white; padding: 30px; max-width: 450px; width: 90%; border-radius: 16px;">
          <h3 style="margin: 0 0 20px 0; color: #2563EB;">Withdraw Funds</h3>
          <div style="margin-bottom: 20px; padding: 15px; background: #F3F4F6; border-radius: 12px;">
            <p style="margin: 0; color: #374151;"><strong>Available Balance:</strong> â‚¬3,450.00</p>
          </div>
          <form id="withdrawal-form">
            <div style="margin-bottom: 15px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 500;">Withdrawal Amount (â‚¬):</label>
              <input type="number" id="withdrawal-amount" step="0.01" min="1" max="3450" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 5px; font-weight: 500;">Bank Account:</label>
              <select id="bank-account" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                <option value="">Select bank account</option>
                <option value="main">Main Account (****1234)</option>
                <option value="savings">Savings Account (****5678)</option>
              </select>
            </div>
            <div style="display: flex; gap: 10px;">
              <button type="submit" style="flex: 1; padding: 12px; background: #059669; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Withdraw Funds
              </button>
              <button type="button" onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="flex: 1; padding: 12px; background: #6B7280; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Cancel
              </button>
            </div>
          </form>
        </div>
      `;

      document.body.appendChild(modal);

      // Handle withdrawal form
      document.getElementById('withdrawal-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const amount = document.getElementById('withdrawal-amount').value;
        const account = document.getElementById('bank-account').value;
        
        try {
          // Simulate withdrawal process
          console.log('Withdrawal request:', { amount, account });
          alert(`Withdrawal of â‚¬${amount} initiated. Funds will arrive in 1-2 business days.`);
          modal.remove();
        } catch (error) {
          console.error('Error processing withdrawal:', error);
          alert('Error processing withdrawal. Please try again.');
        }
      });
    }

    function sendPaymentLinks() {
      alert('Payment links will be sent to all your tenants via email. This feature requires backend integration.');
      // This would integrate with your email system and payment processor
    }

    function addPaymentToHistory(payment) {
      const historyContainer = document.querySelector('.payment-history');
      if (historyContainer) {
        const paymentItem = document.createElement('div');
        paymentItem.className = 'payment-item';
        paymentItem.innerHTML = `
          <div class="payment-info">
            <h4>${payment.type.charAt(0).toUpperCase() + payment.type.slice(1).replace('-', ' ')}</h4>
            <p>From: ${payment.tenant}</p>
            <small>${payment.date}</small>
          </div>
          <div class="payment-details">
            <span class="payment-amount">â‚¬${payment.amount}</span>
            <span class="payment-status ${payment.status}">${payment.status.charAt(0).toUpperCase() + payment.status.slice(1)}</span>
          </div>
        `;
        historyContainer.insertBefore(paymentItem, historyContainer.firstChild);
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      setupViewingAgreement();
      setupApplicantsTable();
      setupCompareApplicants();
      if (window.SmartMatchingUI) {
        window.SmartMatchingUI.initLandlordDashboard({
          matchListSelector: '#landlord-match-list',
          preferenceFormSelector: '#landlord-preferences-form',
          alertSelector: '#landlord-matching-alert'
        });
      } else {
        console.warn('SmartMatchingUI module not available');
      }
      // If messages section is visible on load, initialize messaging
      if (document.getElementById('messages-section').style.display !== 'none') {
        loadConversations();
      }
      // Also setup compare applicants for initial load
      setupCompareApplicants();
      
      // Initialize PayPal integration for premium features
      initializePayPalIntegration();
    });

    // PayPal Integration for Premium Features
    function initializePayPalIntegration() {
      if (typeof PayPalIntegration !== 'undefined') {
        const paypalIntegration = new PayPalIntegration();
        
        // Featured Listing PayPal Button
        if (document.getElementById('featured-listing-paypal')) {
          paypalIntegration.createPremiumPaymentButton(
            'featured-listing-paypal',
            'Featured Listing',
            '19.99',
            'Boost your apartment listing visibility for 30 days',
            function(data) {
              console.log('Featured listing payment successful:', data);
              showSuccessMessage('Your listing has been featured successfully! ðŸŒŸ');
              // Update UI to show featured status
              updateFeatureStatus('featured', true);
            }
          );
        }

        // Priority Support PayPal Button
        if (document.getElementById('priority-support-paypal')) {
          paypalIntegration.createPremiumPaymentButton(
            'priority-support-paypal',
            'Priority Support',
            '9.99',
            'Get priority customer support for faster assistance',
            function(data) {
              console.log('Priority support payment successful:', data);
              showSuccessMessage('Priority support activated! ðŸš€');
              updateFeatureStatus('priority-support', true);
            }
          );
        }

        // Analytics Plus PayPal Button
        if (document.getElementById('analytics-plus-paypal')) {
          paypalIntegration.createPremiumPaymentButton(
            'analytics-plus-paypal',
            'Analytics Plus',
            '14.99',
            'Advanced analytics and insights for your listings',
            function(data) {
              console.log('Analytics Plus payment successful:', data);
              showSuccessMessage('Analytics Plus activated! ðŸ“Š');
              updateFeatureStatus('analytics-plus', true);
            }
          );
        }
      } else {
        console.warn('PayPal integration not available. Please ensure paypal-integration.js is loaded.');
      }
    }

    function showSuccessMessage(message) {
      const alert = document.createElement('div');
      alert.className = 'alert alert-success';
      alert.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #10B981; color: white; padding: 16px; border-radius: 8px; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
      alert.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px;">
          <i class="fa fa-check-circle"></i>
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; margin-left: 8px; cursor: pointer;">Ã—</button>
        </div>
      `;
      document.body.appendChild(alert);
      setTimeout(() => alert.remove(), 5000);
    }

    function updateFeatureStatus(feature, active) {
      // Update UI to reflect active premium features
      const featureCard = document.querySelector(`#${feature.replace('-', '')}-paypal`).closest('.payment-card');
      if (featureCard && active) {
        featureCard.style.border = '2px solid #10B981';
        featureCard.style.background = 'linear-gradient(135deg, #f0fdf4, #ffffff)';
        
        const statusBadge = document.createElement('div');
        statusBadge.className = 'feature-status';
        statusBadge.style.cssText = 'position: absolute; top: 8px; right: 8px; background: #10B981; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;';
        statusBadge.textContent = 'ACTIVE';
        featureCard.style.position = 'relative';
        featureCard.appendChild(statusBadge);
      }
    }
  </script>

  <!-- SichrPlace Footer -->
  <footer style="margin-top: 40px; padding: 20px 0; border-top: 1px solid #E5E7EB; background: var(--secondary);">
      <div class="footer-brand" style="text-align: center; margin: 20px 0;">

        <div class="footer-brand-text" style="color: #6B7280; font-size: 14px;">
              Your Trusted Rental Platform
          </div>
      </div>
      <div class="footer-links" style="text-align: center; margin: 15px 0;">
          <a href="privacy-policy.html" style="color: #6B7280; text-decoration: none; margin: 0 15px; font-size: 14px;">Privacy Policy</a>
          <a href="terms-of-service.html" style="color: #6B7280; text-decoration: none; margin: 0 15px; font-size: 14px;">Terms of Service</a>
          <a href="index.html" style="color: #6B7280; text-decoration: none; margin: 0 15px; font-size: 14px;">Home</a>
      </div>
      <p style="text-align: center; color: #9CA3AF; font-size: 12px; margin: 10px 0 0 0;">&copy; 2025 SichrPlace. All rights reserved.</p>
  </footer>
</body>
</html>