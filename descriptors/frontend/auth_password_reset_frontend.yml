# Frontend Integration Descriptor — Password Reset
# Used with: docs/templates/frontend_integration.ftl
# Rendered to: docs/generated/frontend_integration/auth_password_reset.md

featureName: "Password Reset"
backendTag: "v1.2.0-thesis-showcase"
integrationLevel: "Public (no JWT required)"

userStory: >
  As a user who has forgotten my password, I want to request a reset link
  and set a new password so that I can regain access to my account without
  contacting support.
primaryUserRole: "Any registered user (TENANT, LANDLORD, or ADMIN)"
screenContext: "Login page → 'Forgot password?' link → reset form"

endpoints:
  - httpMethod: "POST"
    endpointPath: "/api/auth/forgot-password"
    authRequired: "No — public endpoint"
    rateLimitNotes: "Recommend frontend rate-limiting (disable button for 60s after submit) to prevent email flooding"
    requestFields:
      - name: "email"
        type: "String"
        required: "Yes"
        constraints: "@NotBlank @Email — must be a valid email format"
    responseFields:
      - name: "message"
        type: "String"
        notes: "Always returns a success message regardless of whether the email exists (prevents user enumeration)"
      - name: "token"
        type: "String"
        notes: "Reset token (returned in response for demo/dev — in production, sent via email only)"
    errorCodes:
      - status: "400"
        meaning: "Validation error (blank or invalid email format)"
        suggestedUx: "Highlight email field with red border; show inline validation message"
    validationHints:
      - "The backend always returns 200 even if the email is not registered — this prevents user enumeration attacks."
      - "In production, the token should be sent via email, not in the response body. The current implementation returns it for demo convenience."
      - "The token is a UUID string, valid for a limited time."

  - httpMethod: "POST"
    endpointPath: "/api/auth/reset-password"
    authRequired: "No — public endpoint (token-based auth)"
    rateLimitNotes: "Recommend disabling submit button after first click to prevent duplicate submissions"
    requestFields:
      - name: "token"
        type: "String"
        required: "Yes"
        constraints: "@NotBlank — the UUID token received from forgot-password"
      - name: "newPassword"
        type: "String"
        required: "Yes"
        constraints: "@NotBlank @Size(min=8) — minimum 8 characters"
    responseFields:
      - name: "message"
        type: "String"
        notes: "Confirmation message (e.g. 'Password has been reset successfully')"
    errorCodes:
      - status: "400"
        meaning: "Validation error (blank token, password too short) or invalid/expired token"
        suggestedUx: "Show specific error message; if token expired, offer link to request a new one"
    validationHints:
      - "Password must be at least 8 characters — enforce this client-side before submission."
      - "If the token is expired or already used, the backend returns 400 — show a 'token expired' message with a link back to forgot-password."
      - "The new password is hashed with BCrypt server-side; never send the raw password in query parameters."

dataFetchPattern: |
  // Step 1: Request reset
  const res1 = await fetch(`${BASE_URL}/api/auth/forgot-password`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: userEmail })
  });
  const data1 = await res1.json();
  // Show "Check your email" message

  // Step 2: Reset password (user clicks link with token)
  const res2 = await fetch(`${BASE_URL}/api/auth/reset-password`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ token: tokenFromUrl, newPassword: newPwd })
  });
  if (!res2.ok) { /* handle 400 */ }
  const data2 = await res2.json();
  // Redirect to login page with success message

stateShape: |
  {
    "step": "request",
    "email": "",
    "token": "",
    "newPassword": "",
    "confirmPassword": "",
    "isSubmitting": false,
    "successMessage": null,
    "error": null
  }

renderHints:
  - "Two-step flow: (1) 'Enter your email' form, (2) 'Enter new password' form."
  - "After step 1 succeeds, show a confirmation screen ('Check your email for a reset link')."
  - "Step 2 is typically reached via a URL with the token as a query parameter (?token=xxx)."
  - "Add a 'confirm password' field client-side (not sent to backend — just for UX validation)."
  - "Show a password strength indicator (optional but recommended)."
  - "After successful reset, redirect to login with a success banner."

breakpoints:
  - name: "≤ 480px (mobile)"
    guidance: "Full-width form centred vertically; large touch-friendly input fields (min 44px height)."
  - name: "481–768px (tablet)"
    guidance: "Form card centred with max-width 400px; generous padding."
  - name: "≥ 769px (desktop)"
    guidance: "Form card centred with max-width 420px; optional split layout with branding on left."

priorityContent:
  - "Email / password input field is always the primary focus element on page load."
  - "Error messages appear directly below the relevant input field."
  - "The submit button is always visible without scrolling."

a11yNotes:
  - "Form inputs must have associated <label> elements (not just placeholder text)."
  - "Error messages should be linked to inputs via aria-describedby."
  - "The submit button should be disabled and show a spinner while isSubmitting is true."
  - "Use role='alert' for success/error messages so screen readers announce them."
  - "Password field should have a show/hide toggle with aria-label='Toggle password visibility'."

mockDataSource: |
  Use Swagger UI at /swagger-ui/index.html to call forgot-password
  with any seeded user email (e.g. alice@example.com). The response
  includes the reset token directly (dev mode). Then call
  reset-password with that token and a new password (min 8 chars).

manualTestChecklist:
  - "Submit forgot-password with a valid registered email — verify 200 and message."
  - "Submit forgot-password with an unregistered email — verify 200 (no user enumeration)."
  - "Submit forgot-password with an invalid email format — verify 400 validation error."
  - "Submit reset-password with valid token and 8+ character password — verify success."
  - "Submit reset-password with a password shorter than 8 characters — verify 400."
  - "Submit reset-password with an expired or already-used token — verify 400."
  - "After successful reset, login with the new password — verify it works."
  - "Resize browser from desktop to mobile — verify form remains usable."
  - "Tab through all form fields — verify logical focus order."
