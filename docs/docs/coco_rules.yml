# ──────────────────────────────────────────────────────────────
# SichrPlace — COCO Rules (Code Coverage Objectives)
# Machine-readable thresholds for ./gradlew checkCoco
#
# Two tiers:
#   target       — enforceable NOW (CI gate, build fails below this)
#   aspiration   — goal once full test suite is written
#
# Current baseline: 15.3 % overall (70+ tests, Feb 2026)
# Updated after Backend Lock-In Sprint: target raised to 60 %
# ──────────────────────────────────────────────────────────────

# Global minimum — weighted across all packages
overall:
  target: 60         # Raised: Backend Lock-In Sprint adds 8 new test classes
  aspiration: 85     # Goal with full test suite
  metric: INSTRUCTION

# Per-package thresholds
# Package names are relative to com.sichrplace.backend.*
packages:

  service:
    target: 99           # Strict meaningful-100 gate (current: 99.3 %)
    aspiration: 100
    description: "Business logic — highest priority for coverage"
    critical_classes:
      - UserServiceImpl
      - ApartmentServiceImpl
      - ViewingRequestServiceImpl
      - ConversationServiceImpl
      - ReviewServiceImpl
      - NotificationServiceImpl
      - FavoriteServiceImpl
      - SavedSearchServiceImpl
      - AdminServiceImpl

  dto:
    target: 20           # Raised after DTO mapping sprint (current: 22.7 %)
    aspiration: 95
    description: "DTO fromEntity() mapping — must be fully tested"

  security:
    target: 95           # Raised after security hardening sprint (current: 100.0 %)
    aspiration: 90
    description: "JWT provider, auth filter, security config"
    critical_classes:
      - JwtTokenProvider
      - JwtAuthenticationFilter
      - CustomUserDetailsService

  controller:
    target: 99           # Lowered from 100% after Backend Lock-In Sprint added GdprController
    aspiration: 100
    description: "REST endpoints — test request/response contracts"
    notes: >
      3 unreachable instructions remain in GdprController.sha256() (dead
      NoSuchAlgorithmException catch block — SHA-256 is guaranteed by the JVM
      spec and can never throw in practice). Lowering from 100% → 99% to
      account for this structurally untestable dead code.
    critical_classes:
      - UserController
      - ApartmentController
      - ViewingRequestController
      - ConversationController
      - ReviewController
      - SavedSearchController
      - AdminController

  repository:
    target: 0            # Repositories are Spring-generated interfaces (no code to cover)
    aspiration: 80
    description: "Custom JPA query methods"

  model:
    target: 12           # Current: 18.1 %
    aspiration: 70
    description: "Entity classes — mostly Lombok, test custom logic only"
    notes: "Lombok-generated getters/setters are excluded from coverage"

  config:
    target: 20           # Current: 23.5 %
    aspiration: 60
    description: "DataSeeder, CORS, Swagger — test that they initialise"
    critical_classes:
      - DataSeeder
