<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Applicant Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
    }


    /* Sidebar styles */
    .sidebar {
      width: 250px;
      background-color: #2563EB; /* Primary Blue */
      color: #FFFFFF; /* White text */
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    }

    .sidebar h2 {
      margin: 0 0 20px;
      font-size: 20px;
      text-align: center;
    }

    .sidebar a {
      text-decoration: none;
      color: #FFFFFF;
      padding: 10px 15px;
      margin: 5px 0;
      border-radius: 5px;
      display: block;
      transition: background-color 0.3s ease;
    }

    .sidebar a:hover {
      background-color: #1E40AF; /* Darker Blue */
    }

    .sidebar a.active {
      background-color: #1E3A8A; /* Active Link Color */
    }

    /* Main content styles */
    .main-content {
      flex: 1;
      padding: 20px;
      background-color: #F9FAFB; /* Light Gray Background */
      overflow-y: auto;
    }

    .main-content h1 {
      font-size: 24px;
      color: #374151; /* Neutral Gray */
    }

    .main-content p {
      color: #6B7280; /* Subtle Gray Text */
    }

    .form-container {
      background: #FFFFFF;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .form-container h2 {
      font-size: 20px;
      color: #2563EB;
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
    }

    input[type="file"] {
      padding: 5px;
    }

    textarea {
      resize: vertical;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-top: 20px;
      background-color: #10B981; /* Green */
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #059669;
    }

    /* Progress bar styles */
    .progress-bar-container {
      margin-top: 20px;
      background-color: #E5E7EB; /* Light Gray */
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      height: 20px;
    }

    .progress-bar {
      height: 100%;
      background-color: #10B981; /* Green */
      width: 0%; /* Start at 0% */
      text-align: center;
      color: white;
      line-height: 20px;
      font-size: 12px;
      transition: width 0.3s ease;
    }

    /* Messaging styles */
    .messages-container {
      display: flex;
      gap: 20px;
    }

    .message-list {
      width: 30%;
      background: #FFFFFF;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .message-box {
      flex: 1;
      background: #FFFFFF;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }

    .chat-window {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #E5E7EB;
      border-radius: 4px;
      background: #F9FAFB;
    }

    .message {
      margin-bottom: 10px;
    }

    .message.sent {
      text-align: right;
    }

    .message.received {
      text-align: left;
    }

    #message-input {
      width: calc(100% - 80px);
      padding: 10px;
      border: 1px solid #E5E7EB;
      border-radius: 4px;
    }

    #message-form button {
      width: 70px;
      padding: 10px;
      background-color: #2563EB;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #message-form button:hover {
      background-color: #1E3A8A;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Dashboard</h2>
    <a href="#" id="profile-link" class="active">Profile</a>
    <a href="#" id="wishlist-link">Wishlist</a>
    <a href="#" id="lastSeen-link">Last Seen Offers</a>
    <a href="#" id="messages-link">Messages</a>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="main-content">
    <h1>Profile</h1>
    <div class="form-container">
      <h2>Update Your Profile</h2>
      <form id="profile-form" action="/api/update-profile" method="POST" enctype="multipart/form-data">
        <!-- Profile Photo -->
        <label for="photo">Profile Photo:</label>
        <input type="file" id="photo" name="photo" accept="image/*">


        <!-- Full Name -->
        <label for="full-name">Full Name:</label>
        <input type="text" id="full-name" name="full-name" placeholder="Enter your full name" required>

        <!-- Email Address -->
        <label for="email">Email Address:</label>
        <input type="email" id="email" name="email" placeholder="Enter your email address" required>

        <!-- Progress Bar -->
        <div class="progress-bar-container">
          <div class="progress-bar" id="progress-bar">Increase your chances of getting your home in Germany</div>
        </div>

        <!-- Additional Questions -->
        <label for="student">Are you a student?</label>
        <select id="student" name="student" required>
          <option value="" disabled selected>Select an option</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>

        <label for="age">How old are you?</label>
        <input type="number" id="age" name="age" placeholder="Enter your age" required>

        <label for="telefon">Telefon Number:</label>
        <input type="tel" id="telefon" name="telefon" placeholder="Enter your phone number" required>

        <label for="dob">Date of Birth:</label>
        <input type="date" id="dob" name="dob" required>

        <label for="income">Monthly Income:</label>
        <input type="number" id="income" name="income" placeholder="Enter your monthly income" required>

        <label for="living-preference">Do you want to live alone or in a WG?</label>
        <select id="living-preference" name="living-preference" required>
          <option value="" disabled selected>Select an option</option>
          <option value="alone">Alone</option>
          <option value="wg">WG (Shared Apartment)</option>
        </select>

        <label for="disabilities">Any kind of disabilities?</label>
        <textarea id="disabilities" name="disabilities" rows="3" placeholder="Describe any disabilities (if applicable)"></textarea>

        <label for="pets">Do you have pets?</label>
        <select id="pets" name="pets" required>
          <option value="" disabled selected>Select an option</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>

        <label for="schufa">SCHUFA Upload (PDF):</label>
        <input type="file" id="schufa" name="schufa" accept=".pdf">

        <label for="moving-date">Preferred Moving Date:</label>
        <input type="date" id="moving-date" name="moving-date">

        <button type="submit">Save Changes</button>
      </form>
    </div>
  </div>

  <script>
    // JavaScript to dynamically update the progress bar
    const form = document.getElementById('profile-form');
    const progressBar = document.getElementById('progress-bar');

    form.addEventListener('input', () => {
      const totalFields = form.elements.length - 1; // Exclude the submit button
      let filledFields = 0;

      for (let i = 0; i < totalFields; i++) {
        if (form.elements[i].value.trim() !== '') {
          filledFields++;
        }
      }

      const progress = Math.round((filledFields / totalFields) * 100);
      progressBar.style.width = `${progress}%`;
      progressBar.textContent = `${progress}% - Increase your chances of getting your home in Germany`;
    });

    // Content for each section
    const content = {
      profile: `
        <h1>Profile</h1>
        <p>Welcome to your profile. Use the sidebar to navigate through your dashboard features.</p>
      `,
      wishlist: `
        <h1>Wishlist</h1>
        <p>Here are your favorite apartments:</p>
        <ul class="offer-list">
          <li><a href="/offer/1">Apartment 1</a></li>
          <li><a href="/offer/2">Apartment 2</a></li>
          <li><a href="/offer/3">Apartment 3</a></li>
        </ul>
      `,
      lastSeen: `
        <h1>Last Time Seen Offers</h1>
        <p>Here are the apartments you recently viewed:</p>
        <ul class="offer-list">
          <li><a href="/offer/4">Apartment 4</a></li>
          <li><a href="/offer/5">Apartment 5</a></li>
          <li><a href="/offer/6">Apartment 6</a></li>
        </ul>
      `,
      messages: `
        <h1>Messages</h1>
        <div class="messages-container">
          <div class="message-list">
            <h2>Conversations</h2>
            <ul id="conversation-list">
              <!-- Conversations will be dynamically loaded here -->
            </ul>
          </div>
          <div class="message-box">
            <h2>Chat</h2>
            <div id="chat-window" class="chat-window">
              <!-- Messages will be dynamically loaded here -->
            </div>
            <form id="message-form">
              <input type="text" id="message-input" placeholder="Type your message..." required>
              <button type="submit">Send</button>
            </form>
          </div>
        </div>
      `,
    };

    // Add click event listeners to sidebar links
    const links = document.querySelectorAll('.sidebar a');
    const mainContent = document.getElementById('main-content');

    links.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();

        // Remove active class from all links
        links.forEach(l => l.classList.remove('active'));

        // Add active class to the clicked link
        link.classList.add('active');

        // Update main content based on the clicked link
        const section = link.id.split('-')[0]; // Extract section name from ID
        mainContent.innerHTML = content[section];

        // Initialize messaging functionality if Messages section is loaded
        if (section === 'messages') {
          loadConversations();
        }
      });
    });

    // Load conversations dynamically
    function loadConversations() {
      const conversationList = document.getElementById('conversation-list');
      const chatWindow = document.getElementById('chat-window');
      const messageForm = document.getElementById('message-form');
      const messageInput = document.getElementById('message-input');

      // Example conversations (replace with backend data)
      const conversations = [
        { id: 1, name: 'Landlord 1' },
        { id: 2, name: 'Landlord 2' },
      ];

      // Populate conversation list
      conversationList.innerHTML = conversations.map(convo => `
        <li data-id="${convo.id}" class="conversation-item">${convo.name}</li>
      `).join('');

      // Add click event to load chat messages
      document.querySelectorAll('.conversation-item').forEach(item => {
        item.addEventListener('click', () => {
          const conversationId = item.getAttribute('data-id');
          loadMessages(conversationId);
        });
      });

      // Load messages for a specific conversation
      function loadMessages(conversationId) {
        // Example messages (replace with backend data)
        const messages = [
          { sender: 'Landlord', text: 'Hello, are you interested in the apartment?' },
          { sender: 'You', text: 'Yes, I am. Can we schedule a viewing?' },
        ];

        // Populate chat window
        chatWindow.innerHTML = messages.map(msg => `
          <div class="message ${msg.sender === 'You' ? 'sent' : 'received'}">
            <p><strong>${msg.sender}:</strong> ${msg.text}</p>
          </div>
        `).join('');
      }

      // Handle sending a new message
      messageForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const newMessage = messageInput.value.trim();
        if (newMessage) {
          // Append the new message to the chat window
          chatWindow.innerHTML += `
            <div class="message sent">
              <p><strong>You:</strong> ${newMessage}</p>
            </div>
          `;
          messageInput.value = ''; // Clear the input field

          // TODO: Send the message to the backend
          console.log(`Message sent to backend: ${newMessage}`);
        }
      });
    }