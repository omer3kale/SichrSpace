<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCHUFA Credit Check - SichrPlace</title>
  
  <!-- Favicon and Icons -->
  <link rel="icon" href="../img/favicon.ico" sizes="any">
  <link rel="icon" href="../img/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="../img/apple-touch-icon.png">
  
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    :root {
      --primary: #2563EB;
      --primary-dark: #1D4ED8;
      --primary-hover: #3B82F6;
      --secondary: #F8FAFC;
      --accent: #40E0D0;
      --success: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
      --text: #1F2937;
      --text-muted: #6B7280;
      --border: #E5E7EB;
      --card: #FFFFFF;
      --background: #F9FAFB;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--background);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      background: var(--card);
      padding: 20px 0;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .logo {
      font-family: 'Poppins', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--text-muted);
      font-size: 14px;
      padding: 8px 16px;
      border-radius: var(--radius);
      transition: all 0.3s ease;
    }

    .nav-links a:hover {
      background: var(--secondary);
      color: var(--text);
    }

    /* Page Title */
    .page-title {
      text-align: center;
      margin-bottom: 40px;
    }

    .page-title h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .page-title .schufa-logo {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #FF6B6B, #FF8E53);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    .page-title p {
      font-size: 16px;
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Info Cards */
    .info-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .info-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary);
    }

    .info-card h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-card p {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* Main Form */
    .schufa-form {
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .form-header {
      margin-bottom: 25px;
      text-align: center;
    }

    .form-header h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
    }

    .form-header p {
      font-size: 14px;
      color: var(--text-muted);
    }

    .form-section {
      margin-bottom: 25px;
    }

    .form-section h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text);
      font-size: 14px;
    }

    .form-group .required {
      color: var(--error);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      font-size: 14px;
      transition: border-color 0.3s ease;
      background: var(--card);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-group .form-help {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 5px;
    }

    /* File Upload */
    .file-upload {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 30px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      background: var(--secondary);
    }

    .file-upload:hover {
      border-color: var(--primary);
      background: var(--card);
    }

    .file-upload.dragover {
      border-color: var(--primary);
      background: rgba(37, 99, 235, 0.1);
    }

    .file-upload-icon {
      font-size: 48px;
      color: var(--text-muted);
      margin-bottom: 15px;
    }

    .file-upload-text {
      font-size: 16px;
      color: var(--text);
      margin-bottom: 5px;
    }

    .file-upload-hint {
      font-size: 14px;
      color: var(--text-muted);
    }

    .file-list {
      margin-top: 15px;
    }

    .file-item {
      display: flex;
      justify-content: between;
      align-items: center;
      padding: 10px;
      background: var(--secondary);
      border-radius: var(--radius);
      margin-bottom: 10px;
    }

    .file-info {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .file-remove {
      color: var(--error);
      cursor: pointer;
      padding: 5px;
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--secondary);
      color: var(--text);
      border: 2px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .btn-lg {
      padding: 15px 30px;
      font-size: 16px;
    }

    /* Alerts */
    .alert {
      padding: 15px;
      border-radius: var(--radius);
      margin-bottom: 20px;
      border-left: 4px solid;
    }

    .alert.success {
      background: #F0FDF4;
      border-color: var(--success);
      color: #166534;
    }

    .alert.warning {
      background: #FFFBEB;
      border-color: var(--warning);
      color: #92400E;
    }

    .alert.error {
      background: #FEF2F2;
      border-color: var(--error);
      color: #991B1B;
    }

    .alert.info {
      background: #EFF6FF;
      border-color: var(--primary);
      color: #1E40AF;
    }

    /* Progress Steps */
    .progress-steps {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .step:not(:last-child)::after {
      content: '';
      width: 30px;
      height: 2px;
      background: var(--border);
      margin-left: 10px;
    }

    .step-circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }

    .step.active .step-circle {
      background: var(--primary);
    }

    .step.completed .step-circle {
      background: var(--success);
    }

    .step-label {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    /* Loading States */
    .loading {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .loading::after {
      content: '';
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Results Section */
    .results-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      display: none;
    }

    .results-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .results-header h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
    }

    .credit-score {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 25px;
    }

    .score-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(var(--success) 0deg, var(--border) 0deg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .score-circle::before {
      content: '';
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: var(--card);
      position: absolute;
    }

    .score-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
      z-index: 1;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .result-item {
      text-align: center;
      padding: 20px;
      border-radius: var(--radius);
      background: var(--secondary);
    }

    .result-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 5px;
    }

    .result-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .header-content {
        padding: 0 15px;
      }

      .page-title h1 {
        font-size: 24px;
        flex-direction: column;
        gap: 10px;
      }

      .info-section {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .progress-steps {
        flex-direction: column;
        align-items: center;
      }

      .step:not(:last-child)::after {
        width: 2px;
        height: 30px;
        margin-left: 0;
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <a href="../index.html" class="logo">
        <i class="fas fa-shield-alt"></i> SichrPlace
      </a>
      <div class="nav-links">
        <a href="tenant-screening-dashboard.html">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <a href="../applicant-dashboard.html">
          <i class="fas fa-user"></i> My Dashboard
        </a>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Page Title -->
    <div class="page-title">
      <h1>
        <div class="schufa-logo">
          <i class="fas fa-credit-card"></i>
        </div>
        SCHUFA Credit Check
      </h1>
      <p>Official German credit verification required by most landlords. Your SCHUFA score determines rental approval eligibility.</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step active" id="step-1">
        <div class="step-circle">1</div>
        <div class="step-label">Personal Info</div>
      </div>
      <div class="step" id="step-2">
        <div class="step-circle">2</div>
        <div class="step-label">Document Upload</div>
      </div>
      <div class="step" id="step-3">
        <div class="step-circle">3</div>
        <div class="step-label">Verification</div>
      </div>
      <div class="step" id="step-4">
        <div class="step-circle">4</div>
        <div class="step-label">Results</div>
      </div>
    </div>

    <!-- Info Section -->
    <div class="info-section">
      <div class="info-card">
        <h3><i class="fas fa-info-circle"></i> What is SCHUFA?</h3>
        <p>SCHUFA is Germany's leading credit bureau. Your SCHUFA score (300-1000) reflects your creditworthiness and payment history, essential for rental applications.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-clock"></i> Processing Time</h3>
        <p>SCHUFA verification typically takes 1-2 business days. Results are valid for 90 days and can be used for multiple rental applications.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-shield-alt"></i> Data Security</h3>
        <p>Your personal data is encrypted and processed securely according to German GDPR regulations. We never store sensitive information permanently.</p>
      </div>
    </div>

    <!-- Alert Container -->
    <div id="alert-container"></div>

    <!-- Main Form -->
    <div class="schufa-form" id="schufa-form">
      <div class="form-header">
        <h2>SCHUFA Credit Check Application</h2>
        <p>Please provide accurate information to ensure successful verification</p>
      </div>

      <form id="schufa-application-form">
        <!-- Personal Information -->
        <div class="form-section">
          <h3><i class="fas fa-user"></i> Personal Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="first-name">First Name <span class="required">*</span></label>
              <input type="text" id="first-name" name="firstName" required>
            </div>
            <div class="form-group">
              <label for="last-name">Last Name <span class="required">*</span></label>
              <input type="text" id="last-name" name="lastName" required>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="birth-date">Date of Birth <span class="required">*</span></label>
              <input type="date" id="birth-date" name="birthDate" required>
            </div>
            <div class="form-group">
              <label for="birth-place">Place of Birth</label>
              <input type="text" id="birth-place" name="birthPlace" placeholder="e.g., Berlin, Germany">
            </div>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="form-section">
          <h3><i class="fas fa-map-marker-alt"></i> Current Address</h3>
          <div class="form-group">
            <label for="street-address">Street Address <span class="required">*</span></label>
            <input type="text" id="street-address" name="streetAddress" placeholder="e.g., Berliner Str. 123" required>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="postal-code">Postal Code <span class="required">*</span></label>
              <input type="text" id="postal-code" name="postalCode" placeholder="e.g., 10115" required>
              <div class="form-help">German postal code (5 digits)</div>
            </div>
            <div class="form-group">
              <label for="city">City <span class="required">*</span></label>
              <input type="text" id="city" name="city" placeholder="e.g., Berlin" required>
            </div>
          </div>
        </div>

        <!-- Identity Verification -->
        <div class="form-section">
          <h3><i class="fas fa-id-card"></i> Identity Verification</h3>
          <div class="form-group">
            <label for="id-type">ID Document Type <span class="required">*</span></label>
            <select id="id-type" name="idType" required>
              <option value="">Select document type...</option>
              <option value="passport">German Passport</option>
              <option value="id-card">German ID Card (Personalausweis)</option>
              <option value="eu-passport">EU Passport</option>
              <option value="residence-permit">Residence Permit (Aufenthaltstitel)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="id-number">Document Number <span class="required">*</span></label>
            <input type="text" id="id-number" name="idNumber" placeholder="e.g., T12345678" required>
            <div class="form-help">Enter the ID/passport number exactly as shown on your document</div>
          </div>
        </div>

        <!-- Document Upload -->
        <div class="form-section">
          <h3><i class="fas fa-upload"></i> Document Upload</h3>
          <p style="margin-bottom: 15px; color: var(--text-muted); font-size: 14px;">
            Upload clear photos or scans of required documents. Maximum file size: 10MB per file.
          </p>
          
          <div class="form-group">
            <label>Identity Document <span class="required">*</span></label>
            <div class="file-upload" id="id-upload">
              <div class="file-upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <div class="file-upload-text">Upload ID Document</div>
              <div class="file-upload-hint">Drag & drop or click to browse (JPG, PNG, PDF)</div>
              <input type="file" id="id-file" accept=".jpg,.jpeg,.png,.pdf" style="display: none;">
            </div>
            <div id="id-file-list" class="file-list"></div>
          </div>

          <div class="form-group">
            <label>Proof of Address (optional)</label>
            <div class="file-upload" id="address-upload">
              <div class="file-upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <div class="file-upload-text">Upload Address Proof</div>
              <div class="file-upload-hint">Utility bill, bank statement, or registration certificate</div>
              <input type="file" id="address-file" accept=".jpg,.jpeg,.png,.pdf" style="display: none;">
            </div>
            <div id="address-file-list" class="file-list"></div>
          </div>
        </div>

        <!-- Consent and Terms -->
        <div class="form-section">
          <h3><i class="fas fa-shield-alt"></i> Consent & Authorization</h3>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="schufa-consent" name="schufaConsent" required>
              <span class="checkmark"></span>
              I authorize SCHUFA to process my personal data and provide credit information to SichrPlace for rental application purposes. <span class="required">*</span>
            </label>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="data-processing" name="dataProcessing" required>
              <span class="checkmark"></span>
              I agree to the <a href="#" target="_blank">data processing terms</a> and understand that my information will be handled according to GDPR regulations. <span class="required">*</span>
            </label>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="landlord-sharing" name="landlordSharing">
              <span class="checkmark"></span>
              I authorize sharing my SCHUFA results with verified landlords on SichrPlace platform.
            </label>
          </div>
        </div>

        <!-- Submit Button -->
        <div style="text-align: center; margin-top: 30px;">
          <button type="submit" class="btn btn-primary btn-lg btn-full" id="submit-btn">
            <i class="fas fa-check"></i> Submit SCHUFA Application
          </button>
        </div>
      </form>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="results-section">
      <div class="results-header">
        <h2>SCHUFA Credit Check Results</h2>
        <p>Your credit verification has been completed successfully</p>
      </div>

      <div class="credit-score">
        <div class="score-circle" id="score-circle">
          <div class="score-value" id="score-value">750</div>
        </div>
      </div>

      <div class="results-grid">
        <div class="result-item">
          <div class="result-value" id="risk-category">LOW RISK</div>
          <div class="result-label">Risk Category</div>
        </div>
        <div class="result-item">
          <div class="result-value" id="verification-date">2025-01-22</div>
          <div class="result-label">Verification Date</div>
        </div>
        <div class="result-item">
          <div class="result-value" id="valid-until">2025-04-22</div>
          <div class="result-label">Valid Until</div>
        </div>
        <div class="result-item">
          <div class="result-value" id="qualification-status">APPROVED</div>
          <div class="result-label">Qualification Status</div>
        </div>
      </div>

      <div style="text-align: center; margin-top: 25px;">
        <button class="btn btn-success btn-lg" id="download-certificate">
          <i class="fas fa-download"></i> Download Certificate
        </button>
        <button class="btn btn-secondary btn-lg" id="back-to-dashboard">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Configuration
    const API_BASE_URL = '/.netlify/functions/tenant-screening';
    let currentStep = 1;
    let uploadedFiles = {};

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initializeSchufaForm();
      setupEventListeners();
      setupFileUploads();
      checkViewMode();
    });

    function initializeSchufaForm() {
      // Get apartment ID from URL params
      const urlParams = new URLSearchParams(window.location.search);
      const apartmentId = urlParams.get('apartment');
      
      if (apartmentId) {
        console.log('Processing SCHUFA check for apartment:', apartmentId);
      }
    }

    function checkViewMode() {
      const urlParams = new URLSearchParams(window.location.search);
      const viewMode = urlParams.get('view');
      
      if (viewMode === 'results') {
        showResults();
      }
    }

    function setupEventListeners() {
      // Form submission
      document.getElementById('schufa-application-form').addEventListener('submit', handleFormSubmit);

      // Back to dashboard
      document.getElementById('back-to-dashboard').addEventListener('click', function() {
        window.location.href = 'tenant-screening-dashboard.html';
      });

      // Download certificate
      document.getElementById('download-certificate').addEventListener('click', downloadCertificate);

      // Postal code validation
      document.getElementById('postal-code').addEventListener('input', validatePostalCode);
    }

    function setupFileUploads() {
      setupFileUpload('id-upload', 'id-file', 'id-file-list', 'idDocument');
      setupFileUpload('address-upload', 'address-file', 'address-file-list', 'addressProof');
    }

    function setupFileUpload(uploadAreaId, fileInputId, fileListId, fileType) {
      const uploadArea = document.getElementById(uploadAreaId);
      const fileInput = document.getElementById(fileInputId);
      const fileList = document.getElementById(fileListId);

      // Click to upload
      uploadArea.addEventListener('click', () => fileInput.click());

      // File selection
      fileInput.addEventListener('change', function() {
        handleFileSelection(this.files, fileListId, fileType);
      });

      // Drag and drop
      uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
        handleFileSelection(e.dataTransfer.files, fileListId, fileType);
      });
    }

    function handleFileSelection(files, fileListId, fileType) {
      const fileList = document.getElementById(fileListId);
      
      Array.from(files).forEach(file => {
        if (validateFile(file)) {
          uploadedFiles[fileType] = file;
          displayFile(file, fileList, fileType);
        }
      });
    }

    function validateFile(file) {
      const maxSize = 10 * 1024 * 1024; // 10MB
      const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];

      if (file.size > maxSize) {
        showAlert('File size must be less than 10MB', 'error');
        return false;
      }

      if (!allowedTypes.includes(file.type)) {
        showAlert('Only JPG, PNG, and PDF files are allowed', 'error');
        return false;
      }

      return true;
    }

    function displayFile(file, container, fileType) {
      container.innerHTML = '';
      
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      fileItem.innerHTML = `
        <div class="file-info">
          <i class="fas fa-file-${getFileIcon(file.type)}"></i>
          <span>${file.name}</span>
          <small>(${formatFileSize(file.size)})</small>
        </div>
        <i class="fas fa-times file-remove" onclick="removeFile('${fileType}', this)"></i>
      `;
      
      container.appendChild(fileItem);
    }

    function removeFile(fileType, element) {
      delete uploadedFiles[fileType];
      element.closest('.file-item').remove();
    }

    function getFileIcon(mimeType) {
      if (mimeType.includes('pdf')) return 'pdf';
      if (mimeType.includes('image')) return 'image';
      return 'file';
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function validatePostalCode() {
      const postalCode = document.getElementById('postal-code').value;
      const isValid = /^\d{5}$/.test(postalCode);
      
      const input = document.getElementById('postal-code');
      if (postalCode && !isValid) {
        input.style.borderColor = 'var(--error)';
      } else {
        input.style.borderColor = 'var(--border)';
      }
    }

    async function handleFormSubmit(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submit-btn');
      const originalText = submitBtn.innerHTML;
      
      try {
        // Show loading state
        submitBtn.innerHTML = '<span class="loading">Processing SCHUFA Application</span>';
        submitBtn.disabled = true;

        // Validate required files
        if (!uploadedFiles.idDocument) {
          throw new Error('Please upload your ID document');
        }

        // Collect form data
        const formData = new FormData(e.target);
        
        // Add files to form data
        Object.entries(uploadedFiles).forEach(([key, file]) => {
          formData.append(key, file);
        });

        // Mock API call - replace with actual API
        await mockSchufaSubmission(formData);

        // Show success and redirect to results
        showAlert('SCHUFA application submitted successfully! Processing will take 1-2 business days.', 'success');
        
        setTimeout(() => {
          showResults();
        }, 2000);

      } catch (error) {
        console.error('SCHUFA submission error:', error);
        showAlert(error.message || 'Failed to submit SCHUFA application. Please try again.', 'error');
        
        // Restore button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }

    async function mockSchufaSubmission(formData) {
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Mock successful response
      return {
        success: true,
        schufaId: 'SCHUFA_' + Date.now(),
        estimatedCompletion: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString()
      };
    }

    function showResults() {
      // Hide form and show results
      document.getElementById('schufa-form').style.display = 'none';
      document.getElementById('results-section').style.display = 'block';
      
      // Update progress steps
      updateProgressSteps(4);
      
      // Mock results data
      const mockResults = {
        creditScore: 750,
        riskCategory: 'LOW RISK',
        verificationDate: '2025-01-22',
        validUntil: '2025-04-22',
        qualificationStatus: 'APPROVED'
      };

      // Update results display
      updateScoreCircle(mockResults.creditScore);
      document.getElementById('score-value').textContent = mockResults.creditScore;
      document.getElementById('risk-category').textContent = mockResults.riskCategory;
      document.getElementById('verification-date').textContent = mockResults.verificationDate;
      document.getElementById('valid-until').textContent = mockResults.validUntil;
      document.getElementById('qualification-status').textContent = mockResults.qualificationStatus;
    }

    function updateProgressSteps(step) {
      for (let i = 1; i <= 4; i++) {
        const stepElement = document.getElementById(`step-${i}`);
        if (i <= step) {
          stepElement.classList.add('completed');
          stepElement.classList.remove('active');
        } else {
          stepElement.classList.remove('completed', 'active');
        }
      }
      
      if (step <= 4) {
        document.getElementById(`step-${step}`).classList.add('active');
      }
    }

    function updateScoreCircle(score) {
      const maxScore = 1000;
      const percentage = (score / maxScore) * 100;
      const degree = (percentage / 100) * 360;
      
      const scoreCircle = document.getElementById('score-circle');
      const color = score >= 700 ? 'var(--success)' : score >= 500 ? 'var(--warning)' : 'var(--error)';
      
      scoreCircle.style.background = `conic-gradient(${color} ${degree}deg, var(--border) ${degree}deg)`;
    }

    function downloadCertificate() {
      // Mock certificate download
      const link = document.createElement('a');
      link.href = '#'; // Replace with actual certificate URL
      link.download = 'SCHUFA_Certificate_2025.pdf';
      link.click();
      
      showAlert('Certificate download started', 'success');
    }

    function showAlert(message, type) {
      const alertContainer = document.getElementById('alert-container');
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert ${type}`;
      alertDiv.innerHTML = `
        <i class="fas fa-${getAlertIcon(type)}"></i>
        ${message}
      `;

      alertContainer.appendChild(alertDiv);

      // Auto-remove after 5 seconds
      setTimeout(() => {
        alertDiv.remove();
      }, 5000);
    }

    function getAlertIcon(type) {
      switch (type) {
        case 'success': return 'check-circle';
        case 'warning': return 'exclamation-triangle';
        case 'error': return 'times-circle';
        default: return 'info-circle';
      }
    }

    // Checkbox styling
    const style = document.createElement('style');
    style.textContent = `
      .checkbox-label {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        cursor: pointer;
        line-height: 1.4;
      }
      
      .checkbox-label input[type="checkbox"] {
        width: auto;
        margin: 0;
      }
      
      .checkbox-label a {
        color: var(--primary);
        text-decoration: none;
      }
      
      .checkbox-label a:hover {
        text-decoration: underline;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>