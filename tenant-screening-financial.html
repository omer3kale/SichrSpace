<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Qualification - SichrPlace</title>
  
  <!-- Favicon and Icons -->
  <link rel="icon" href="../img/favicon.ico" sizes="any">
  <link rel="icon" href="../img/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="../img/apple-touch-icon.png">
  
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    :root {
      --primary: #2563EB;
      --primary-dark: #1D4ED8;
      --primary-hover: #3B82F6;
      --secondary: #F8FAFC;
      --accent: #40E0D0;
      --success: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
      --text: #1F2937;
      --text-muted: #6B7280;
      --border: #E5E7EB;
      --card: #FFFFFF;
      --background: #F9FAFB;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--background);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      background: var(--card);
      padding: 20px 0;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .logo {
      font-family: 'Poppins', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--text-muted);
      font-size: 14px;
      padding: 8px 16px;
      border-radius: var(--radius);
      transition: all 0.3s ease;
    }

    .nav-links a:hover {
      background: var(--secondary);
      color: var(--text);
    }

    /* Page Title */
    .page-title {
      text-align: center;
      margin-bottom: 40px;
    }

    .page-title h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .page-title .financial-logo {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #F59E0B, #D97706);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    .page-title p {
      font-size: 16px;
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Info Cards */
    .info-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .info-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--warning);
    }

    .info-card h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-card p {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* Financial Calculator */
    .financial-calculator {
      background: linear-gradient(135deg, #FFFBEB, #FEF3C7);
      border-radius: var(--radius);
      padding: 25px;
      margin-bottom: 30px;
      border: 2px solid var(--warning);
    }

    .financial-calculator h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 18px;
      font-weight: 600;
      color: var(--warning);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .calculator-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .calculator-item {
      background: var(--card);
      padding: 15px;
      border-radius: var(--radius);
      text-align: center;
    }

    .calculator-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 5px;
    }

    .calculator-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text);
    }

    .calculator-input {
      width: 100%;
      padding: 10px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      font-size: 14px;
      text-align: center;
    }

    .qualification-badge {
      padding: 10px 20px;
      border-radius: var(--radius);
      font-weight: 600;
      text-align: center;
      margin: 15px 0;
    }

    .qualification-badge.excellent {
      background: #DCFCE7;
      color: #166534;
      border: 2px solid var(--success);
    }

    .qualification-badge.good {
      background: #FEF3C7;
      color: #92400E;
      border: 2px solid var(--warning);
    }

    .qualification-badge.poor {
      background: #FEE2E2;
      color: #991B1B;
      border: 2px solid var(--error);
    }

    /* Main Form */
    .financial-form {
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .form-header {
      margin-bottom: 25px;
      text-align: center;
    }

    .form-header h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
    }

    .form-header p {
      font-size: 14px;
      color: var(--text-muted);
    }

    .form-section {
      margin-bottom: 25px;
    }

    .form-section h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text);
      font-size: 14px;
    }

    .form-group .required {
      color: var(--error);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      font-size: 14px;
      transition: border-color 0.3s ease;
      background: var(--card);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-group .form-help {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 5px;
    }

    .form-group .currency-input {
      position: relative;
    }

    .form-group .currency-input::before {
      content: '€';
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-weight: 500;
      z-index: 1;
    }

    .form-group .currency-input input {
      padding-left: 30px;
    }

    /* Debt Items */
    .debt-items {
      background: var(--secondary);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
    }

    .debt-item {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 15px;
      align-items: end;
      margin-bottom: 15px;
      padding: 15px;
      background: var(--card);
      border-radius: var(--radius);
    }

    .debt-item:last-child {
      margin-bottom: 0;
    }

    .debt-remove {
      color: var(--error);
      cursor: pointer;
      padding: 10px;
      font-size: 16px;
    }

    .add-debt {
      background: var(--card);
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .add-debt:hover {
      border-color: var(--primary);
      background: var(--secondary);
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--secondary);
      color: var(--text);
      border: 2px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .btn-lg {
      padding: 15px 30px;
      font-size: 16px;
    }

    /* Alerts */
    .alert {
      padding: 15px;
      border-radius: var(--radius);
      margin-bottom: 20px;
      border-left: 4px solid;
    }

    .alert.success {
      background: #F0FDF4;
      border-color: var(--success);
      color: #166534;
    }

    .alert.warning {
      background: #FFFBEB;
      border-color: var(--warning);
      color: #92400E;
    }

    .alert.error {
      background: #FEF2F2;
      border-color: var(--error);
      color: #991B1B;
    }

    .alert.info {
      background: #EFF6FF;
      border-color: var(--primary);
      color: #1E40AF;
    }

    /* Results Section */
    .results-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      display: none;
    }

    .results-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .results-header h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
    }

    .affordability-score {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 25px;
    }

    .score-gauge {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: conic-gradient(var(--success) 0deg, var(--border) 0deg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .score-gauge::before {
      content: '';
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: var(--card);
      position: absolute;
    }

    .score-content {
      z-index: 1;
      text-align: center;
    }

    .score-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
    }

    .score-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .result-item {
      text-align: center;
      padding: 20px;
      border-radius: var(--radius);
      background: var(--secondary);
    }

    .result-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 5px;
    }

    .result-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Financial Breakdown */
    .financial-breakdown {
      margin-top: 25px;
      background: var(--secondary);
      border-radius: var(--radius);
      padding: 20px;
    }

    .breakdown-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }

    .breakdown-item:last-child {
      border-bottom: none;
      font-weight: 600;
      font-size: 16px;
      color: var(--text);
    }

    .breakdown-label {
      color: var(--text-muted);
    }

    .breakdown-value {
      font-weight: 500;
      color: var(--text);
    }

    /* Loading States */
    .loading {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .loading::after {
      content: '';
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .header-content {
        padding: 0 15px;
      }

      .page-title h1 {
        font-size: 24px;
        flex-direction: column;
        gap: 10px;
      }

      .info-section {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .calculator-grid {
        grid-template-columns: 1fr;
      }

      .debt-item {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <a href="../index.html" class="logo">
        <i class="fas fa-shield-alt"></i> SichrPlace
      </a>
      <div class="nav-links">
        <a href="tenant-screening-dashboard.html">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <a href="../applicant-dashboard.html">
          <i class="fas fa-user"></i> My Dashboard
        </a>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Page Title -->
    <div class="page-title">
      <h1>
        <div class="financial-logo">
          <i class="fas fa-calculator"></i>
        </div>
        Financial Qualification
      </h1>
      <p>Complete financial assessment including affordability analysis, debt-to-income ratio, and qualification scoring for German rental market.</p>
    </div>

    <!-- Info Section -->
    <div class="info-section">
      <div class="info-card">
        <h3><i class="fas fa-chart-line"></i> Affordability Analysis</h3>
        <p>Comprehensive calculation considering German tax obligations, living costs, and disposable income to determine true rental affordability.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-balance-scale"></i> Debt-to-Income Ratio</h3>
        <p>Assessment of existing financial obligations including loans, credit cards, and monthly commitments relative to your income.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-star"></i> Qualification Score</h3>
        <p>Overall financial qualification score (0-150) based on income stability, affordability, debt ratio, and German rental market standards.</p>
      </div>
    </div>

    <!-- Financial Calculator -->
    <div class="financial-calculator">
      <h3><i class="fas fa-calculator"></i> Live Affordability Calculator</h3>
      <div class="calculator-grid">
        <div class="calculator-item">
          <div class="calculator-label">Monthly Net Income</div>
          <div class="currency-input">
            <input type="number" id="calc-income" placeholder="4000" class="calculator-input">
          </div>
        </div>
        <div class="calculator-item">
          <div class="calculator-label">Target Rent</div>
          <div class="currency-input">
            <input type="number" id="calc-rent" placeholder="1200" class="calculator-input">
          </div>
        </div>
        <div class="calculator-item">
          <div class="calculator-label">Monthly Debt Payments</div>
          <div class="currency-input">
            <input type="number" id="calc-debt" placeholder="500" class="calculator-input">
          </div>
        </div>
        <div class="calculator-item">
          <div class="calculator-label">Disposable Income</div>
          <div class="calculator-value" id="disposable-income">€ 2,300</div>
        </div>
      </div>
      <div class="qualification-badge good" id="live-qualification">
        GOOD QUALIFICATION - Meets rental requirements
      </div>
    </div>

    <!-- Alert Container -->
    <div id="alert-container"></div>

    <!-- Main Form -->
    <div class="financial-form" id="financial-form">
      <div class="form-header">
        <h2>Financial Qualification Assessment</h2>
        <p>Provide detailed financial information for comprehensive qualification analysis</p>
      </div>

      <form id="financial-qualification-form">
        <!-- Income Information -->
        <div class="form-section">
          <h3><i class="fas fa-euro-sign"></i> Income Details</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="gross-income">Monthly Gross Income <span class="required">*</span></label>
              <div class="currency-input">
                <input type="number" id="gross-income" name="grossIncome" placeholder="5000" step="0.01" required>
              </div>
              <div class="form-help">Before taxes and deductions</div>
            </div>
            <div class="form-group">
              <label for="net-income">Monthly Net Income <span class="required">*</span></label>
              <div class="currency-input">
                <input type="number" id="net-income" name="netIncome" placeholder="3200" step="0.01" required>
              </div>
              <div class="form-help">After taxes and deductions</div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="additional-income">Additional Monthly Income</label>
              <div class="currency-input">
                <input type="number" id="additional-income" name="additionalIncome" placeholder="0" step="0.01">
              </div>
              <div class="form-help">Bonuses, rental income, investments, etc.</div>
            </div>
            <div class="form-group">
              <label for="income-stability">Income Stability</label>
              <select id="income-stability" name="incomeStability">
                <option value="very-stable">Very Stable (Permanent job, 3+ years)</option>
                <option value="stable">Stable (Permanent job, 1-3 years)</option>
                <option value="moderate">Moderate (Contract/Temp work)</option>
                <option value="variable">Variable (Freelance/Commission)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Monthly Expenses -->
        <div class="form-section">
          <h3><i class="fas fa-shopping-cart"></i> Monthly Living Expenses</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="housing-costs">Current Housing Costs</label>
              <div class="currency-input">
                <input type="number" id="housing-costs" name="housingCosts" placeholder="800" step="0.01">
              </div>
              <div class="form-help">Current rent, utilities, insurance</div>
            </div>
            <div class="form-group">
              <label for="food-expenses">Food & Groceries</label>
              <div class="currency-input">
                <input type="number" id="food-expenses" name="foodExpenses" placeholder="400" step="0.01">
              </div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="transport-costs">Transportation</label>
              <div class="currency-input">
                <input type="number" id="transport-costs" name="transportCosts" placeholder="200" step="0.01">
              </div>
              <div class="form-help">Public transport, car payments, fuel</div>
            </div>
            <div class="form-group">
              <label for="insurance-costs">Insurance Premiums</label>
              <div class="currency-input">
                <input type="number" id="insurance-costs" name="insuranceCosts" placeholder="150" step="0.01">
              </div>
              <div class="form-help">Health, car, liability insurance</div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="other-expenses">Other Monthly Expenses</label>
              <div class="currency-input">
                <input type="number" id="other-expenses" name="otherExpenses" placeholder="300" step="0.01">
              </div>
              <div class="form-help">Entertainment, subscriptions, personal care</div>
            </div>
          </div>
        </div>

        <!-- Debts and Financial Obligations -->
        <div class="form-section">
          <h3><i class="fas fa-credit-card"></i> Debts & Financial Obligations</h3>
          <div class="debt-items" id="debt-items">
            <!-- Debt items will be added dynamically -->
          </div>
          <div class="add-debt" id="add-debt-btn">
            <i class="fas fa-plus"></i> Add Debt/Loan
          </div>
        </div>

        <!-- Assets and Savings -->
        <div class="form-section">
          <h3><i class="fas fa-piggy-bank"></i> Assets & Savings</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="savings-account">Savings Account Balance</label>
              <div class="currency-input">
                <input type="number" id="savings-account" name="savingsAccount" placeholder="5000" step="0.01">
              </div>
              <div class="form-help">Emergency fund and liquid savings</div>
            </div>
            <div class="form-group">
              <label for="investment-value">Investment Portfolio Value</label>
              <div class="currency-input">
                <input type="number" id="investment-value" name="investmentValue" placeholder="0" step="0.01">
              </div>
              <div class="form-help">Stocks, bonds, funds (market value)</div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="property-value">Real Estate Value</label>
              <div class="currency-input">
                <input type="number" id="property-value" name="propertyValue" placeholder="0" step="0.01">
              </div>
              <div class="form-help">Owned property (minus mortgages)</div>
            </div>
            <div class="form-group">
              <label for="other-assets">Other Assets</label>
              <div class="currency-input">
                <input type="number" id="other-assets" name="otherAssets" placeholder="0" step="0.01">
              </div>
              <div class="form-help">Vehicles, valuable items, etc.</div>
            </div>
          </div>
        </div>

        <!-- Employment and Risk Factors -->
        <div class="form-section">
          <h3><i class="fas fa-briefcase"></i> Employment & Risk Assessment</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="employment-length">Current Employment Length</label>
              <select id="employment-length" name="employmentLength">
                <option value="5plus">5+ years</option>
                <option value="3-5">3-5 years</option>
                <option value="1-3">1-3 years</option>
                <option value="6-12">6-12 months</option>
                <option value="less-6">Less than 6 months</option>
              </select>
            </div>
            <div class="form-group">
              <label for="industry-stability">Industry Stability</label>
              <select id="industry-stability" name="industryStability">
                <option value="high">High (Healthcare, Education, Government)</option>
                <option value="medium">Medium (Technology, Finance, Manufacturing)</option>
                <option value="low">Low (Hospitality, Retail, Freelance)</option>
              </select>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="guarantor-available">Guarantor Available</label>
              <select id="guarantor-available" name="guarantorAvailable">
                <option value="yes">Yes - Family/Friend willing to guarantee</option>
                <option value="professional">Yes - Professional guarantor service</option>
                <option value="no">No guarantor available</option>
              </select>
            </div>
            <div class="form-group">
              <label for="deposit-available">Security Deposit Available</label>
              <select id="deposit-available" name="depositAvailable">
                <option value="full">Full deposit (3 months rent) ready</option>
                <option value="partial">Partial deposit available</option>
                <option value="need-time">Need time to accumulate</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Target Rental Information -->
        <div class="form-section">
          <h3><i class="fas fa-home"></i> Target Rental Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="target-rent">Target Monthly Rent <span class="required">*</span></label>
              <div class="currency-input">
                <input type="number" id="target-rent" name="targetRent" placeholder="1200" step="0.01" required>
              </div>
              <div class="form-help">Including utilities and additional costs</div>
            </div>
            <div class="form-group">
              <label for="rental-duration">Intended Rental Duration</label>
              <select id="rental-duration" name="rentalDuration">
                <option value="long-term">Long-term (2+ years)</option>
                <option value="medium-term">Medium-term (1-2 years)</option>
                <option value="short-term">Short-term (6-12 months)</option>
                <option value="temporary">Temporary (less than 6 months)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div style="text-align: center; margin-top: 30px;">
          <button type="submit" class="btn btn-primary btn-lg btn-full" id="submit-btn">
            <i class="fas fa-calculator"></i> Calculate Financial Qualification
          </button>
        </div>
      </form>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="results-section">
      <div class="results-header">
        <h2>Financial Qualification Results</h2>
        <p>Your comprehensive financial assessment has been completed</p>
      </div>

      <div class="affordability-score">
        <div class="score-gauge" id="score-gauge">
          <div class="score-content">
            <div class="score-value" id="score-value">127</div>
            <div class="score-label">Affordability Score</div>
          </div>
        </div>
      </div>

      <div class="results-grid">
        <div class="result-item">
          <div class="result-value" id="qualification-level">EXCELLENT</div>
          <div class="result-label">Qualification Level</div>
        </div>
        <div class="result-item">
          <div class="result-value" id="debt-to-income">18%</div>
          <div class="result-label">Debt-to-Income Ratio</div>
        </div>
        <div class="result-item">
          <div class="result-value" id="affordability-ratio">3.8:1</div>
          <div class="result-label">Income-to-Rent Ratio</div>
        </div>
        <div class="result-item">
          <div class="result-value" id="disposable-after-rent">€ 2,100</div>
          <div class="result-label">Disposable Income</div>
        </div>
      </div>

      <!-- Financial Breakdown -->
      <div class="financial-breakdown">
        <h3 style="margin-bottom: 15px; color: var(--text);">Financial Breakdown</h3>
        <div class="breakdown-item">
          <span class="breakdown-label">Monthly Net Income</span>
          <span class="breakdown-value" id="breakdown-income">€ 4,500</span>
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">Target Rent & Utilities</span>
          <span class="breakdown-value" id="breakdown-rent">€ 1,200</span>
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">Debt Payments</span>
          <span class="breakdown-value" id="breakdown-debt">€ 450</span>
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">Living Expenses</span>
          <span class="breakdown-value" id="breakdown-expenses">€ 750</span>
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">Remaining Disposable Income</span>
          <span class="breakdown-value" id="breakdown-disposable">€ 2,100</span>
        </div>
      </div>

      <div style="text-align: center; margin-top: 25px;">
        <button class="btn btn-success btn-lg" id="download-assessment">
          <i class="fas fa-download"></i> Download Assessment Report
        </button>
        <button class="btn btn-secondary btn-lg" id="back-to-dashboard">
          <i class="fas fa-arrow-left"></i> Back to Dashboard
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Configuration
    const API_BASE_URL = '/.netlify/functions/tenant-screening';
    let debts = [];
    let nextDebtId = 1;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initializeFinancialForm();
      setupEventListeners();
      setupLiveCalculator();
      checkViewMode();
    });

    function initializeFinancialForm() {
      // Get apartment ID from URL params
      const urlParams = new URLSearchParams(window.location.search);
      const apartmentId = urlParams.get('apartment');
      
      if (apartmentId) {
        console.log('Processing financial qualification for apartment:', apartmentId);
      }
    }

    function checkViewMode() {
      const urlParams = new URLSearchParams(window.location.search);
      const viewMode = urlParams.get('view');
      
      if (viewMode === 'results') {
        showResults();
      }
    }

    function setupEventListeners() {
      // Form submission
      document.getElementById('financial-qualification-form').addEventListener('submit', handleFormSubmit);

      // Add debt button
      document.getElementById('add-debt-btn').addEventListener('click', addDebt);

      // Back to dashboard
      document.getElementById('back-to-dashboard').addEventListener('click', function() {
        window.location.href = 'tenant-screening-dashboard.html';
      });

      // Download assessment
      document.getElementById('download-assessment').addEventListener('click', downloadAssessment);

      // Form input updates
      document.getElementById('net-income').addEventListener('input', updateCalculatorFromForm);
      document.getElementById('target-rent').addEventListener('input', updateCalculatorFromForm);
    }

    function setupLiveCalculator() {
      // Calculator inputs
      document.getElementById('calc-income').addEventListener('input', updateLiveCalculator);
      document.getElementById('calc-rent').addEventListener('input', updateLiveCalculator);
      document.getElementById('calc-debt').addEventListener('input', updateLiveCalculator);
      
      // Initial calculation
      updateLiveCalculator();
    }

    function updateLiveCalculator() {
      const income = parseFloat(document.getElementById('calc-income').value) || 0;
      const rent = parseFloat(document.getElementById('calc-rent').value) || 0;
      const debt = parseFloat(document.getElementById('calc-debt').value) || 0;
      
      // Estimate living expenses (typical German values)
      const estimatedExpenses = income * 0.35; // 35% of income for living expenses
      const disposableIncome = income - rent - debt - estimatedExpenses;
      
      // Update disposable income display
      document.getElementById('disposable-income').textContent = `€ ${disposableIncome.toLocaleString()}`;
      
      // Update qualification badge
      const qualificationBadge = document.getElementById('live-qualification');
      const incomeRatio = income / rent;
      
      if (rent === 0) {
        qualificationBadge.textContent = 'Enter target rent to see qualification';
        qualificationBadge.className = 'qualification-badge good';
      } else if (incomeRatio >= 3.5 && disposableIncome >= 800) {
        qualificationBadge.textContent = 'EXCELLENT QUALIFICATION - Strong financial position';
        qualificationBadge.className = 'qualification-badge excellent';
      } else if (incomeRatio >= 3 && disposableIncome >= 500) {
        qualificationBadge.textContent = 'GOOD QUALIFICATION - Meets rental requirements';
        qualificationBadge.className = 'qualification-badge good';
      } else {
        qualificationBadge.textContent = 'POOR QUALIFICATION - May need guarantor or higher income';
        qualificationBadge.className = 'qualification-badge poor';
      }
    }

    function updateCalculatorFromForm() {
      const netIncome = parseFloat(document.getElementById('net-income').value) || 0;
      const targetRent = parseFloat(document.getElementById('target-rent').value) || 0;
      
      if (netIncome > 0) {
        document.getElementById('calc-income').value = netIncome;
      }
      if (targetRent > 0) {
        document.getElementById('calc-rent').value = targetRent;
      }
      
      updateLiveCalculator();
    }

    function addDebt() {
      const debtId = nextDebtId++;
      const debt = {
        id: debtId,
        type: '',
        amount: '',
        description: ''
      };

      debts.push(debt);
      renderDebt(debt);
    }

    function renderDebt(debt) {
      const container = document.getElementById('debt-items');
      
      const debtItem = document.createElement('div');
      debtItem.className = 'debt-item';
      debtItem.id = `debt-${debt.id}`;
      
      debtItem.innerHTML = `
        <div class="form-group">
          <label for="debt-type-${debt.id}">Debt Type</label>
          <select id="debt-type-${debt.id}" name="debtType">
            <option value="">Select type...</option>
            <option value="credit-card">Credit Card</option>
            <option value="personal-loan">Personal Loan</option>
            <option value="car-loan">Car Loan</option>
            <option value="student-loan">Student Loan</option>
            <option value="mortgage">Mortgage</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label for="debt-amount-${debt.id}">Monthly Payment</label>
          <div class="currency-input">
            <input type="number" id="debt-amount-${debt.id}" name="debtAmount" 
                   placeholder="150" step="0.01">
          </div>
        </div>
        <div class="form-group">
          <label for="debt-description-${debt.id}">Description</label>
          <input type="text" id="debt-description-${debt.id}" name="debtDescription" 
                 placeholder="e.g., Visa Card">
        </div>
        <div class="debt-remove" onclick="removeDebt(${debt.id})">
          <i class="fas fa-trash"></i>
        </div>
      `;

      container.appendChild(debtItem);
      
      // Update calculator when debt amounts change
      document.getElementById(`debt-amount-${debt.id}`).addEventListener('input', updateDebtCalculator);
    }

    function removeDebt(debtId) {
      // Remove from array
      debts = debts.filter(debt => debt.id !== debtId);
      
      // Remove from DOM
      const debtItem = document.getElementById(`debt-${debtId}`);
      if (debtItem) {
        debtItem.remove();
      }
      
      updateDebtCalculator();
    }

    function updateDebtCalculator() {
      // Calculate total debt payments
      let totalDebt = 0;
      debts.forEach(debt => {
        const amount = parseFloat(document.getElementById(`debt-amount-${debt.id}`).value) || 0;
        totalDebt += amount;
      });
      
      // Update live calculator
      document.getElementById('calc-debt').value = totalDebt;
      updateLiveCalculator();
    }

    async function handleFormSubmit(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submit-btn');
      const originalText = submitBtn.innerHTML;
      
      try {
        // Show loading state
        submitBtn.innerHTML = '<span class="loading">Calculating Financial Qualification</span>';
        submitBtn.disabled = true;

        // Collect form data
        const formData = new FormData(e.target);
        
        // Collect debt data
        const debtData = debts.map(debt => {
          return {
            id: debt.id,
            type: document.getElementById(`debt-type-${debt.id}`).value,
            amount: parseFloat(document.getElementById(`debt-amount-${debt.id}`).value) || 0,
            description: document.getElementById(`debt-description-${debt.id}`).value
          };
        });
        
        formData.append('debts', JSON.stringify(debtData));

        // Mock API call - replace with actual API
        await mockFinancialSubmission(formData);

        // Show success and redirect to results
        showAlert('Financial qualification calculated successfully! Your comprehensive assessment is ready.', 'success');
        
        setTimeout(() => {
          showResults();
        }, 2000);

      } catch (error) {
        console.error('Financial qualification error:', error);
        showAlert(error.message || 'Failed to calculate financial qualification. Please try again.', 'error');
        
        // Restore button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }

    async function mockFinancialSubmission(formData) {
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Mock successful response
      return {
        success: true,
        qualificationId: 'FIN_' + Date.now(),
        affordabilityScore: 127,
        qualificationLevel: 'EXCELLENT'
      };
    }

    function showResults() {
      // Hide form and show results
      document.getElementById('financial-form').style.display = 'none';
      document.getElementById('results-section').style.display = 'block';
      
      // Mock results data
      const mockResults = {
        affordabilityScore: 127,
        qualificationLevel: 'EXCELLENT',
        debtToIncomeRatio: '18%',
        affordabilityRatio: '3.8:1',
        disposableAfterRent: '€ 2,100',
        monthlyIncome: '€ 4,500',
        targetRent: '€ 1,200',
        debtPayments: '€ 450',
        livingExpenses: '€ 750',
        disposableIncome: '€ 2,100'
      };

      // Update results display
      updateScoreGauge(mockResults.affordabilityScore);
      document.getElementById('score-value').textContent = mockResults.affordabilityScore;
      document.getElementById('qualification-level').textContent = mockResults.qualificationLevel;
      document.getElementById('debt-to-income').textContent = mockResults.debtToIncomeRatio;
      document.getElementById('affordability-ratio').textContent = mockResults.affordabilityRatio;
      document.getElementById('disposable-after-rent').textContent = mockResults.disposableAfterRent;
      
      // Update breakdown
      document.getElementById('breakdown-income').textContent = mockResults.monthlyIncome;
      document.getElementById('breakdown-rent').textContent = mockResults.targetRent;
      document.getElementById('breakdown-debt').textContent = mockResults.debtPayments;
      document.getElementById('breakdown-expenses').textContent = mockResults.livingExpenses;
      document.getElementById('breakdown-disposable').textContent = mockResults.disposableIncome;
    }

    function updateScoreGauge(score) {
      const maxScore = 150;
      const percentage = (score / maxScore) * 100;
      const degree = (percentage / 100) * 360;
      
      const scoreGauge = document.getElementById('score-gauge');
      let color;
      
      if (score >= 120) {
        color = 'var(--success)';
      } else if (score >= 80) {
        color = 'var(--warning)';
      } else {
        color = 'var(--error)';
      }
      
      scoreGauge.style.background = `conic-gradient(${color} ${degree}deg, var(--border) ${degree}deg)`;
    }

    function downloadAssessment() {
      // Mock assessment download
      const link = document.createElement('a');
      link.href = '#'; // Replace with actual assessment URL
      link.download = 'Financial_Assessment_Report_2025.pdf';
      link.click();
      
      showAlert('Assessment report download started', 'success');
    }

    function showAlert(message, type) {
      const alertContainer = document.getElementById('alert-container');
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert ${type}`;
      alertDiv.innerHTML = `
        <i class="fas fa-${getAlertIcon(type)}"></i>
        ${message}
      `;

      alertContainer.appendChild(alertDiv);

      // Auto-remove after 5 seconds
      setTimeout(() => {
        alertDiv.remove();
      }, 5000);
    }

    function getAlertIcon(type) {
      switch (type) {
        case 'success': return 'check-circle';
        case 'warning': return 'exclamation-triangle';
        case 'error': return 'times-circle';
        default: return 'info-circle';
      }
    }

    // Initialize with one debt item
    addDebt();

    // Global function for removing debts (needed for onclick)
    window.removeDebt = removeDebt;
  </script>
</body>
</html>